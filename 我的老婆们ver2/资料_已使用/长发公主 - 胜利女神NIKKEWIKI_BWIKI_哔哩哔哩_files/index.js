!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).GameNativeReport={})}(this,(function(e){"use strict";function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function n(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?t(Object(r),!0).forEach((function(t){l(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function r(){r=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof p?t:p,a=Object.create(i.prototype),c=new k(r||[]);return o(a,"_invoke",{value:S(e,n,c)}),a}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var d={};function p(){}function h(){}function v(){}var m={};u(m,a,(function(){return this}));var g=Object.getPrototypeOf,y=g&&g(g(T([])));y&&y!==t&&n.call(y,a)&&(m=y);var b=v.prototype=p.prototype=Object.create(m);function w(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function r(o,i,a,c){var s=f(e[o],e,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==typeof l&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,c)}),(function(e){r("throw",e,a,c)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function S(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return x()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=O(a,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=f(e,t,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}function O(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,O(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var o=f(r,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,d;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function T(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:x}}function x(){return{value:void 0,done:!0}}return h.prototype=v,o(b,"constructor",{value:v,configurable:!0}),o(v,"constructor",{value:h,configurable:!0}),h.displayName=u(v,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,s,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},w(E.prototype),u(E.prototype,c,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new E(l(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},w(b),u(b,s,"Generator"),u(b,a,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=T,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(R),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(c&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),R(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;R(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:T(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function i(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function c(e){i(a,r,o,c,s,"next",e)}function s(e){i(a,r,o,c,s,"throw",e)}c(void 0)}))}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,m(r.key),r)}}function u(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function l(e,t,n){return(t=m(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,c=[],s=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=i.call(n)).done)&&(c.push(r.value),c.length!==t);s=!0);}catch(e){u=!0,o=e}finally{try{if(!s&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return c}}(e,t)||p(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||p(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){if(e){if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function v(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=p(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}function m(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var g=function(){return g=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},g.apply(this,arguments)};function y(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function c(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))}function b(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}"function"==typeof SuppressedError&&SuppressedError;var w,E=!1;function S(){return!1===E&&(E="undefined"!=typeof window),E}var O=function(){if(S())return window}();function _(){if(S())return O.__biliMirror__=O.__biliMirror__||{},O.__biliMirror__}var R=S()&&(null===(w=document.getElementsByTagName("meta").spm_prefix)||void 0===w?void 0:w.content)||"0.0";function k(e,t,n,r){void 0===r&&(r=!1),e.addEventListener(t,n,r)}function T(){return Date.now()}var x=Object.prototype.toString;function I(e){return function(t){return x.call(t)==="[object ".concat(e,"]")}}var P={isNumber:I("Number"),isString:I("String"),isBoolean:I("Boolean"),isNull:I("Null"),isUndefined:I("Undefined"),isSymbol:I("Symbol"),isFunction:I("Function"),isObject:I("Object"),isArray:I("Array"),isProcess:I("process"),isWindow:I("Window")};function N(e,t){void 0===t&&(t=["chrome-extension"]);var n=(null==e?void 0:e.message)||"",r=(null==e?void 0:e.fileName)||"";if(!n)return!0;if((n=n.split("?")[0]).includes(location.hostname))return!0;if(!t.length)return!1;var o=!1;if(r)for(var i=0;i<t.length;i++)if(r.match(t[i])){o=!0;break}if(o)return o;for(i=0;i<t.length;i++)if(n.match(t[i])){o=!0;break}return o}function j(e){if("0"===e)return 0;if(P.isNumber(e))return e>10?10:e<=0?1:e;if(P.isString(e)&&!isNaN(e)){var t=parseInt(e);return t>10?10:t<=0?1:t}return console.warn("mirror-kv-[config] sampling rate error,pleace set 1-10"),1}function C(e){return Math.floor(10*Math.random()+1)>e}function L(){return"undefined"==typeof document||null==document.location?"":document.location.href}function A(e){if(!e)return{};var t=e.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!t)return{};var n=t[6]||"",r=t[8]||"";return{host:t[4],path:t[5],protocol:t[2],relative:t[5]+n+r}}function D(e,t,n,r){if(void 0===r&&(r=!1),void 0!==e&&(t in e||r)){var o=n(e[t]);"function"==typeof o&&(e[t]=o)}}var B="1.5.14",M=B;function H(){return H=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},H.apply(this,arguments)}function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var F,J,K,V=2592e6;!function(e){e[e.NON_STRICT=0]="NON_STRICT",e[e.STRICT=1]="STRICT"}(F||(F={})),function(e){e.KEY="key",e.GROUP="group",e.APP="app"}(J||(J={})),function(e){e.PV="333.1334.kv-init.pv",e.ERROR="333.1334.kv-init.error"}(K||(K={}));var q=new(function(){function e(){this.queue=[],this.reporter=void 0,this.loading=!1}var t=e.prototype;return t.loadScript=function(e,t){try{var n=document;return Promise.resolve(new Promise((function(r,o){var i,a=document.getElementById(e);a&&a.parentElement&&window.ReporterPb?r(""):((a=n.createElement("script")).onload=function(){return r("")},a.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||r("")},a.onerror=function(){return o("load report script error")},a.id=e,a.type="text/JavaScript",a.src=t,null==(i=n.querySelector("head"))||i.appendChild(a))})))}catch(e){return Promise.reject(e)}},t.init=function(){try{var e=this;return Promise.resolve(function(t,n){try{var r=function(){function t(){e.reporter=new window.ReporterPb({spmPrefix:"333.1334",sampleRate:1,autoPv:!1,retry:!1,feature:{tech:!0}}),e.loading=!1,e.reportQueue()}if(!e.reporter&&void 0!==typeof window&&!e.loading){e.loading=!0;var n=function(){if(!window.ReporterPb)return Promise.resolve(e.loadScript("kvReportDb","//s1.hdslb.com/bfs/seed/jinkela/short/reporter-pb/index.js")).then((function(){}))}();return n&&n.then?n.then(t):t()}}()}catch(e){return n(e)}return r&&r.then?r.then(void 0,n):r}(0,(function(t){e.loading=!1,console.error(t)})))}catch(e){return Promise.reject(e)}},t.reportQueue=function(){if(this.reporter)for(var e,t=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return U(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?U(e,t):void 0}}(e))){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(this.queue);!(e=t()).done;){var n=e.value;this.report(n.event,n.value)}},t.report=function(e,t){void 0===t&&(t={});try{if(!this.reporter)return this.queue.push({event:e,value:t}),void this.init();var n=H({type:e===K.ERROR?"error":"custom"},t);this.reporter.tech(e,n)}catch(e){console.error(e)}},e}()),W="KV_CONFIG_SDK",G=function(){function e(e){var t=e.appKey,n=e.nscode;this.appKey=void 0,this.appKeyStorageName=void 0,this.appKey=t,this.appKeyStorageName=t+"_"+n,this.checkLocalStorage()}var t=e.prototype;return t.checkLocalStorage=function(){var t=e.getLocalStorage();if(t){for(var n in t){var r=(new Date).getTime();t[n].timestamp+t[n].expires<r&&delete t[n]}Object.keys(t).length>40&&Object.keys(t).sort((function(e,n){return t[e].lastUsed-t[n].lastUsed})).slice(40).forEach((function(e){delete t[e]})),e.setLocalStorage(t)}},t.getAppKey=function(){var t=e.getLocalStorage()||{};return t[this.appKeyStorageName]?(t[this.appKeyStorageName].lastUsed=(new Date).getTime(),e.setLocalStorage(t),t[this.appKeyStorageName]||{}):{}},t.setAppkey=function(t){var n=H({timestamp:(new Date).getTime(),lastUsed:(new Date).getTime()},t),r=e.getLocalStorage()||{};r[this.appKeyStorageName]=n,e.setLocalStorage(r)},e.getLocalStorage=function(){var e;try{(e=localStorage.getItem(W))&&(e=JSON.parse(e))}catch(t){console.error("从本地获取"+W+"的时候异常",t),e=void 0,q.report(K.ERROR,{message:"从本地获取"+W+"的时候异常"+(t.message||"")})}return e},e.setLocalStorage=function(e){try{localStorage.setItem(W,JSON.stringify(e))}catch(e){!function(e){var t=!1;if(e)if(e.code)switch(e.code){case 22:t=!0;break;case 1014:"NS_ERROR_DOM_QUOTA_REACHED"===e.name&&(t=!0)}else-2147024882===e.number&&(t=!0);return t}(e)?(console.log("storage 更新失败",e),q.report(K.ERROR,{message:"storage 更新失败"+(e.message||"")})):(console.log("storage 超出浏览器限制",e),q.report(K.ERROR,{message:"storage 超出浏览器限制"+(e.message||"")}))}},e}();function $(e,t,n){return new Promise((function(r,o){(function(e,t){return new Promise((function(n,r){var o=new XMLHttpRequest;function i(){if(o){var e,t,i=o.responseType,a=(e=o.getAllResponseHeaders().trim().split(/[\r\n]+/),t={},e.forEach((function(e){var n=e.split(": "),r=n.shift(),o=n.join(": ");r&&(t[r]=o)})),t);!o.status||o.status>=200&&o.status<=299?n({data:i&&"text"!==i?o.response:o.responseText,status:o.status,statusText:o.statusText,headers:a}):r(new Error("Request Error: "+o.status+" "+o.statusText)),o=null}}if(o.open((null==t?void 0:t.method)||"GET",e,!0),o.timeout=(null==t?void 0:t.timeout)||2e3,o.responseType=(null==t?void 0:t.responseType)||"json",o.onreadystatechange=function(){o&&4===o.readyState&&(0!==o.status||o.responseURL&&0===o.responseURL.indexOf("file:"))&&setTimeout(i)},o.onabort=function(){o&&(r(new Error("Request aborted: "+e)),o=null)},o.onerror=function(){r(new Error("Network Error: "+e)),o=null},o.ontimeout=function(){r(null!=t&&t.timeout?"Timeout exceeded: "+t.timeout:"Timeout exceeded"),o=null},o.withCredentials=(null==t?void 0:t.withCredentials)||!1,null!=t&&t.headers)for(var a in t.headers)o.setRequestHeader(a,t.headers[a]);o.send((null==t?void 0:t.data)||null)}))})(function(e,t,n){void 0===t&&(t={});var r=t?Object.keys(t).map((function(e){return e+"="+t[e]})).join("&"):"";return""+((null==n?void 0:n.baseURL)||window.location.protocol+"//"+"api.YmlsaWJpbGk=.com".split(".").map((function(e,t){return 1===t?window.atob(e):e})).join("."))+e+(r?"?"+r:"")}(e,t,n),{method:"GET"}).then((function(e){var t=e.data,n=void 0===t?{}:t;0===n.code?r(n):o(n)}),(function(e){o(e)})).catch((function(e){o(e)}))}))}function z(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}var Y=function(){function e(e){this.options={appKey:"",apiURL:"",nscode:0,expires:V,strict:F.STRICT},this.storage=void 0,this.fetchPromise=void 0,this.flattenValue={},this.nestedValue={};var t=e.appKey,n=e.expires,r=void 0===n?V:n;if(!t)return q.report(K.ERROR,{message:"no appkey passed"}),void console.warn("appKey is required");this.options=H({},this.options,e,{expires:Math.min(r,V)}),this.storage=new G({appKey:t,nscode:this.options.nscode});var o=this.storage.getAppKey(),i=o.versionId;this.updateValue(o.value||{}),(this.options.strict!==F.NON_STRICT||e.autoFetch)&&(this.fetchPromise=this.fetchAppKey(i)),this.report(K.PV)}var t=e.prototype;return t.getAll=function(){try{return Promise.resolve(this.getBase(J.APP))}catch(e){return Promise.reject(e)}},t.getGroup=function(e){try{return Promise.resolve(this.getBase(J.GROUP,e))}catch(e){return Promise.reject(e)}},t.get=function(e){try{return Promise.resolve(this.getBase(J.KEY,e))}catch(e){return Promise.reject(e)}},t.getBase=function(e,t){void 0===t&&(t="");try{var n=this,r=function(){if(e===J.APP)return n.nestedValue;if(e===J.GROUP)return n.nestedValue[t]||{};var r=t.split("."),o=r[0];return n.nestedValue[o]?n.nestedValue[o][r[1]]:""};if(n.options.strict===F.NON_STRICT||!n.options.appKey)return Promise.resolve(r());if(!n.fetchPromise){var o=n.storage.getAppKey();n.fetchPromise=n.fetchAppKey(o.versionId)}return Promise.resolve(n.fetchPromise.then((function(){return r()})))}catch(e){return Promise.reject(e)}},t.fetchAppKey=function(e){try{var t=this,n=t.options,r=n.appKey,o=n.nscode,i=z((function(){return Promise.resolve($("/x/kv-frontend/namespace/data",{appKey:r,versionId:e,nscode:o},{baseURL:t.options.apiURL})).then((function(e){var n=e.data;t.storage.setAppkey({value:n.data,versionId:n.versionId,appVersionId:n.appVersionId,nscode:o,appKey:t.options.appKey,expires:t.options.expires}),t.updateValue(n.data)}))}),(function(e){-304!==e.code&&t.report(K.ERROR,{message:e.message||e.msg||"获取失败"})}));return Promise.resolve(i&&i.then?i.then((function(){})):void 0)}catch(e){return Promise.reject(e)}},e.updateLocalAppKey=function(e){try{return Promise.resolve(z((function(){var t=e.appKey,n=e.appVersionId,r=e.apiBaseURL,o=G.getLocalStorage();if(o){var i=Object.keys(o).filter((function(e){return o[e].appKey===t&&o[e].appVersionId!==n})).map((function(e){return o[e]}));if(i.length)return Promise.resolve($("/x/kv-frontend/app/batchupdates",{appKey:t,batches:JSON.stringify(i.map((function(e){return{appVersionId:e.appVersionId,nscode:e.nscode}})))},{baseURL:r})).then((function(e){var n=e.data,r=G.getLocalStorage()||{};n.forEach((function(e){var n=t+"_"+e.nscode;if(e.deleted)delete r[n];else if(e.updated){var o={timestamp:(new Date).getTime(),value:e.data,versionId:e.versionId,appVersionId:e.appVersionId,nscode:e.nscode,appKey:t};r[n]=H({},r[n]||{},o)}})),G.setLocalStorage(r)}))}}),(function(e){-304!==e.code&&console.error(e)})))}catch(e){return Promise.reject(e)}},t.updateValue=function(e){var t=this;this.flattenValue=e;var n={};Object.keys(this.flattenValue).forEach((function(e){var r=e.split("."),o=r[0],i=r[1];n[o]||(n[o]={}),n[o][i]=t.flattenValue[e]})),this.nestedValue=n},t.report=function(e,t){void 0===t&&(t={}),q.report(e,H({appKey:this.options.appKey,nscode:this.options.nscode,sdkVersion:"1.2.7"},t))},e}(),Q=_(),X="333.1333",Z=function(){function e(){this.origin="bili",this.module="common",this.config={},this._defaultConfigSDK=new Y({appKey:X,strict:F.STRICT})}return e.prototype.fetchWhiteListConfig=function(e,t){var n=this;return new Promise((function(r,o){e.get(t).then((function(e){if(e){var t=JSON.parse(e);n.config.white=(null==t?void 0:t.white)||[],n.config["white-retry"]=(null==t?void 0:t.retry)||[],n.config["white-preformance-rate"]=t.performance?j(null==t?void 0:t.performance):1,n.config["poll-time"]=t.poll?j(null==t?void 0:t.poll):5,n.config["tech-pv"]=t.techpv?j(null==t?void 0:t.techpv):5,n.config["user-log"]=(null==t?void 0:t.userLog)||[],n.config["resource-time"]=(null==t?void 0:t.resourceTime)||{},r(t)}else o()})).catch((function(e){o(e)}))}))},e.prototype.getConfig=function(){var e=this;return new Promise((function(t){var n,r,o=X,i="bilimirror",a="whitelist",c=e.spmId||R;c!==o?(e._configSDK&&c===(null===(r=null===(n=e._configSDK)||void 0===n?void 0:n.options)||void 0===r?void 0:r.appKey)||(delete e._configSDK,e._configSDK=new Y({appKey:c,strict:F.STRICT})),e.fetchWhiteListConfig(e._configSDK,"".concat(i,".").concat(a)).then((function(){t()})).catch((function(n){console.warn("bili-mirror:not find ".concat(c," kv-config,using base")),e.fetchWhiteListConfig(e._defaultConfigSDK,"".concat(i,".").concat(a)).then((function(){t()})).catch((function(e){t(),console.warn("bilimirror获取白名单配置失败")}))}))):e.fetchWhiteListConfig(e._defaultConfigSDK,"".concat(i,".").concat(a)).then((function(){t()})).catch((function(e){t(),console.warn("bilimirror获取白名单配置失败")}))}))},e.prototype.bindOptions=function(e){return void 0===e&&(e={}),y(this,void 0,void 0,(function(){var t=this;return b(this,(function(n){switch(n.label){case 0:return Q.mirrorVersion=M,Object.keys(e).forEach((function(n){"config"!==n&&("module"===n&&"function"==typeof e[n]?t[n]=e[n]():t[n]=e[n])})),[4,this.getConfig()];case 1:return n.sent(),[2,Promise.resolve("ok")]}}))}))},e.prototype.updateModule=function(e){this.module=e},e}();var ee=S()?Q.options||(Q.options=new Z):null;var te,ne,re,oe,ie,ae,ce,se,ue,le,fe=-1,de=function(e){addEventListener("pageshow",(function(t){t.persisted&&(fe=t.timeStamp,e(t))}),!0)},pe=function(){return window.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]},he=function(){var e=pe();return e&&e.activationStart||0},ve=function(e,t){var n=pe(),r="navigate";return fe>=0?r="back-forward-cache":n&&(document.prerendering||he()>0?r="prerender":document.wasDiscarded?r="restore":n.type&&(r=n.type.replace(/_/g,"-"))),{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:"v3-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:r}},me=function(e,t,n){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var r=new PerformanceObserver((function(e){Promise.resolve().then((function(){t(e.getEntries())}))}));return r.observe(Object.assign({type:e,buffered:!0},n||{})),r}}catch(e){}},ge=function(e,t,n,r){var o,i;return function(a){t.value>=0&&(a||r)&&((i=t.value-(o||0))||void 0===o)&&(o=t.value,t.delta=i,t.rating=function(e,t){return e>t[1]?"poor":e>t[0]?"needs-improvement":"good"}(t.value,n),e(t))}},ye=function(e){requestAnimationFrame((function(){return requestAnimationFrame((function(){return e()}))}))},be=function(e){var t=function(t){"pagehide"!==t.type&&"hidden"!==document.visibilityState||e(t)};addEventListener("visibilitychange",t,!0),addEventListener("pagehide",t,!0)},we=function(e){var t=!1;return function(n){t||(e(n),t=!0)}},Ee=-1,Se=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},Oe=function(e){"hidden"===document.visibilityState&&Ee>-1&&(Ee="visibilitychange"===e.type?e.timeStamp:0,Re())},_e=function(){addEventListener("visibilitychange",Oe,!0),addEventListener("prerenderingchange",Oe,!0)},Re=function(){removeEventListener("visibilitychange",Oe,!0),removeEventListener("prerenderingchange",Oe,!0)},ke=function(){return Ee<0&&(Ee=Se(),_e(),de((function(){setTimeout((function(){Ee=Se(),_e()}),0)}))),{get firstHiddenTime(){return Ee}}},Te=function(e){document.prerendering?addEventListener("prerenderingchange",(function(){return e()}),!0):e()},xe=[1800,3e3],Ie=function(e,t){t=t||{},Te((function(){var n,r=ke(),o=ve("FCP"),i=me("paint",(function(e){e.forEach((function(e){"first-contentful-paint"===e.name&&(i.disconnect(),e.startTime<r.firstHiddenTime&&(o.value=Math.max(e.startTime-he(),0),o.entries.push(e),n(!0)))}))}));i&&(n=ge(e,o,xe,t.reportAllChanges),de((function(r){o=ve("FCP"),n=ge(e,o,xe,t.reportAllChanges),ye((function(){o.value=performance.now()-r.timeStamp,n(!0)}))})))}))},Pe=[.1,.25],Ne={passive:!0,capture:!0},je=new Date,Ce=function(e,t){te||(te=t,ne=e,re=new Date,De(removeEventListener),Le())},Le=function(){if(ne>=0&&ne<re-je){var e={entryType:"first-input",name:te.type,target:te.target,cancelable:te.cancelable,startTime:te.timeStamp,processingStart:te.timeStamp+ne};oe.forEach((function(t){t(e)})),oe=[]}},Ae=function(e){if(e.cancelable){var t=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?function(e,t){var n=function(){Ce(e,t),o()},r=function(){o()},o=function(){removeEventListener("pointerup",n,Ne),removeEventListener("pointercancel",r,Ne)};addEventListener("pointerup",n,Ne),addEventListener("pointercancel",r,Ne)}(t,e):Ce(t,e)}},De=function(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(t){return e(t,Ae,Ne)}))},Be=[100,300],Me=[2500,4e3],He={},Ue=[800,1800],Fe=function e(t){document.prerendering?Te((function(){return e(t)})):"complete"!==document.readyState?addEventListener("load",(function(){return e(t)}),!0):setTimeout(t,0)},Je=function(e,t){t=t||{};var n=ve("TTFB"),r=ge(e,n,Ue,t.reportAllChanges);Fe((function(){var o=pe();if(o){var i=o.responseStart;if(i<=0||i>performance.now())return;n.value=Math.max(i-he(),0),n.entries=[o],r(!0),de((function(){n=ve("TTFB",0),(r=ge(e,n,Ue,t.reportAllChanges))(!0)}))}}))},Ke=function(e){return!!S()&&function(){try{return S()&&PerformanceObserver?PerformanceObserver.supportedEntryTypes||[]:null}catch(e){console.error("bili-mirror: supportList 解析异常:",e)}}().includes(e)};function Ve(e){window.performance.getEntriesByType&&window.addEventListener("load",(function(){var t=window.performance;t&&setTimeout((function(){var n=t.getEntriesByType("navigation")[0],r={redirectTime:n.redirectEnd-n.redirectStart,dnsTime:n.domainLookupEnd-n.domainLookupStart,tcpTime:n.connectEnd-n.connectStart,sslTime:"https:"===location.protocol?n.connectEnd-n.secureConnectionStart:0,ttfbTime:n.responseStart-n.startTime,requestDoneTime:n.responseEnd-n.responseStart,domParseTime:n.domContentLoadedEventEnd-n.responseEnd,resourceDownloadTime:n.loadEventEnd-n.domContentLoadedEventEnd,pageTime:n.duration};e({name:"PAGETIME",data:r,value:1})}),0)}))}!function(e){e.INIT="init",e.ERROR="error",e.UNHANDLEDREJECTION="unhandledrejection",e.RESOURCE="resource",e.PERFORMANCE="performance",e.WHITESCREEN="whiteScreen",e.BREABCRUMB="breadcrumb"}(ie||(ie={})),function(e){e.ERROR="error",e.CLICK="click",e.HISTORY="history",e.HASHCHANGE="hashchange",e.UNHANDLEDREJECTION="unhandledrejection",e.RESOURCE="resource",e.WHITE="white",e.CUSTOM="custom"}(ae||(ae={})),function(e){e.BEFORE="mirrorHandlerBefore",e.AFTER="mirrorHandlerAfter"}(ce||(ce={})),function(e){e.ERROR="error",e.OK="ok"}(se||(se={})),function(e){e.AUTO="auto",e.DEFAULT="default"}(ue||(ue={})),function(e){e.HISTORY="history",e.HASH="hash",e.DOM="dom",e.JS="js",e.PROMISE="promise",e.RESOURCE="resource",e.WHITE="white"}(le||(le={}));var qe={isExclusive:1},We={mirrorPolymer:3},Ge=function(e,t,n){void 0===t&&(t="before");var r=[],o=!1,i=0;return{start:function(){var a=this;return new Promise((function(c){return y(a,void 0,void 0,(function(){var a,s,u,l,f;return b(this,(function(d){switch(d.label){case 0:if(o)return[2];o=!0,d.label=1;case 1:return i<e.length?(a=e[i],"before"!==t?[3,3]:(u=(s=r).push,[4,null==a?void 0:a.mirrorHandleBefore(n.type,n.data)])):[3,6];case 2:return u.apply(s,[d.sent()]),[3,5];case 3:return f=(l=r).push,[4,null==a?void 0:a.mirrorHandleAfter(n.type,n.data)];case 4:f.apply(l,[d.sent()]),d.label=5;case 5:return i++,o?[3,1]:[2];case 6:return o=!1,c(r),[2]}}))}))}))}}},$e=function(){function e(){this.timeID=null,this.func=null}return e.prototype.repeat=function(e,t){var n=this;null===this.func&&(this.func=e),this.func===e&&(this.timeID=setTimeout((function(){e(),n.repeat(e,t)}),t))},e.prototype.clear=function(){clearTimeout(this.timeID)},e}(),ze=null,Ye=null,Qe=6e4*((null==ee?void 0:ee.config["poll-time"])||5),Xe="BILI_MIRROR_REPORT_POOL";(null==ee?void 0:ee.config["poll-time"])||setTimeout((function(){Qe=6e4*((null==ee?void 0:ee.config["poll-time"])||5)}),1e3);var Ze=function(){try{var e=JSON.parse(localStorage.getItem(Xe)||"{}");if(!Object.keys(e).length)return;Object.entries(e).forEach((function(e){var t=e[0],n=e[1];ze.tech(t,n)})),localStorage.setItem(Xe,"{}")}catch(e){}},et=function(){ze&&ze.flush&&ze.flush(),Ye&&Ye.clear()},tt="_BiliGreyResult",nt=function(e){var t;return(null===(t=document.getElementsByTagName("meta")[e])||void 0===t?void 0:t.content)||void 0},rt="//s1.hdslb.com/bfs/seed/jinkela/short/reporter-pb/index.js",ot=function(){if(!S())return{};if(!O[tt])return{};var e=O[tt],t={};Object.entries(e).forEach((function(e){var n=e[0],r=e[1];t["".concat(tt,"_").concat(n)]=r}));var n=function(){var e=nt("offline-version"),t=nt("offline-name"),n=nt("offline-plat");return e?{offlineVersion:e,offlineName:t,offlinePlat:n}:{}}();return g(g({},t),n)}(),it=[],at=!1,ct="",st=null;function ut(){if(it.length&&!at){at=!0;var e=it.shift(),t=e[0],n=e[1],r=e[2],o=e[3];if("middleWare"===n){if(st)return at=!1,dt(r,o),void ut();t(!0).then((function(e){var t;at=!1,ze!==(t=st=e)&&(ze=t),pt(r,o),ut()}))}else t().then((function(){at=!1,n&&r&&n(r,o||void 0),ut()}))}}var lt=function(e,t){t&&Object.keys(t).length>0&&ht(t);var n;n=(e=function(e){return e.event&&!e.eventId&&(e.eventId=e.event),e.eventId.split(".").length<=1&&(e.eventId="".concat(null==ee?void 0:ee.origin,".").concat(null==ee?void 0:ee.module,".").concat(e.eventId)),"appear"===e.type&&(e.type="exposure"),e}(e)).diyevent?e.eventId||e.event:"".concat(e.otherSpmId?e.otherSpmId:(null==ee?void 0:ee.spmId)?null==ee?void 0:ee.spmId:R,".").concat(e.eventId);var r=ct?window[ct]:window.__biliMirrorPbInstance__,o=g(g(g({},e.msg),ot),{mirrorVersion:B,type:e.type||"custom"});r.tech(n,o)},ft=function(e,t){it.push([vt,lt,e,t]),ut()},dt=function(e,t){!e.msg.message&&e.msg.msg&&(e.msg.message=e.msg.msg),st?pt(e,t):(it.push([vt,"middleWare",e,t]),ut())},pt=function(e,t){t&&void 0!==(null==t?void 0:t.isBatch)||(t=Object.assign(t||{},{isBatch:!1}));var n=((null==t?void 0:t.spmId)||R)+"."+((null==t?void 0:t.origin)||(null==ee?void 0:ee.origin))+"."+((null==t?void 0:t.module)||(null==ee?void 0:ee.module));(null==t?void 0:t.isBatch)?function(e,t,n){var r,o=(null===(r=null==t?void 0:t.api)||void 0===r?void 0:r.split("?")[0])||"";try{var i=JSON.parse(localStorage.getItem(Xe)||"{}");i[e]||(i[e]=g(g({},n),We)),i[e][o]?i[e][o]++:i[e][o]=1,localStorage.setItem(Xe,JSON.stringify(i))}catch(e){}Ye||((Ye=new $e).repeat(Ze,Qe),k(O,"beforeunload",(function(){Ze(),et()})))}(n+(t.eventId||".DATA.successReport"),e.msg,g({type:"custom",mirrorVersion:B},ot)):st.tech(n+(t.eventId||".ERROR.errorReport"),g(g({type:e.type||"custom",mirrorVersion:B},e.msg),ot))},ht=function(e){void 0===e&&(e={feature:{tech:!0}}),window.__biliMirrorPbInstance__.options=Object.assign({feature:{tech:!0}},e)},vt=function(e){void 0===e&&(e=!1);try{return new Promise((function(t,n){if(S()||n("not support in server"),e){var r={feature:{tech:!0},autoPv:!1,batch:!1};if(window.ReporterPb){var o=new window.ReporterPb(g({},r));t(o)}else(a=document.createElement("script")).src=rt,document.getElementsByTagName("body")[0].appendChild(a),a.onload=function(){var e=new window.ReporterPb(g({},r));t(e)}}else{var i=(null==ee?void 0:ee.pbOtherNameIns)?null==ee?void 0:ee.pbOtherNameIns:"";if(P.isObject(window[i])&&Object.keys(window[i]).length)ct=i,console.warn("Is using ".concat(i," to report,Please confirm open [tech] config")),t();else if(window.__biliMirrorPbInstance__)t();else{var a,c={feature:{tech:!0}};window.ReporterPb?(window.__biliMirrorPbInstance__=new window.ReporterPb(g(g({},c),null==ee?void 0:ee.pbOptions)),t()):((a=document.createElement("script")).src=rt,document.getElementsByTagName("body")[0].appendChild(a),a.onload=function(){window.__biliMirrorPbInstance__=new window.ReporterPb(g(g({},c),null==ee?void 0:ee.pbOptions)),t()})}}}))}catch(e){console.error("bili-mirror:load pb-report-Error load failed:",e)}};function mt(e,t){return e(t={exports:{}},t.exports),t.exports}var gt=mt((function(e,t){e.exports=function(){function e(e){return!isNaN(parseFloat(e))&&isFinite(e)}function t(e){return e.charAt(0).toUpperCase()+e.substring(1)}function n(e){return function(){return this[e]}}var r=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],i=["fileName","functionName","source"],a=r.concat(o,i,["args"],["evalOrigin"]);function c(e){if(e)for(var n=0;n<a.length;n++)void 0!==e[a[n]]&&this["set"+t(a[n])](e[a[n]])}c.prototype={getArgs:function(){return this.args},setArgs:function(e){if("[object Array]"!==Object.prototype.toString.call(e))throw new TypeError("Args must be an Array");this.args=e},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(e){if(e instanceof c)this.evalOrigin=e;else{if(!(e instanceof Object))throw new TypeError("Eval Origin must be an Object or StackFrame");this.evalOrigin=new c(e)}},toString:function(){var e=this.getFileName()||"",t=this.getLineNumber()||"",n=this.getColumnNumber()||"",r=this.getFunctionName()||"";return this.getIsEval()?e?"[eval] ("+e+":"+t+":"+n+")":"[eval]:"+t+":"+n:r?r+" ("+e+":"+t+":"+n+")":e+":"+t+":"+n}},c.fromString=function(e){var t=e.indexOf("("),n=e.lastIndexOf(")"),r=e.substring(0,t),o=e.substring(t+1,n).split(","),i=e.substring(n+1);if(0===i.indexOf("@"))var a=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(i,""),s=a[1],u=a[2],l=a[3];return new c({functionName:r,args:o||void 0,fileName:s,lineNumber:u||void 0,columnNumber:l||void 0})};for(var s=0;s<r.length;s++)c.prototype["get"+t(r[s])]=n(r[s]),c.prototype["set"+t(r[s])]=function(e){return function(t){this[e]=Boolean(t)}}(r[s]);for(var u=0;u<o.length;u++)c.prototype["get"+t(o[u])]=n(o[u]),c.prototype["set"+t(o[u])]=function(t){return function(n){if(!e(n))throw new TypeError(t+" must be a Number");this[t]=Number(n)}}(o[u]);for(var l=0;l<i.length;l++)c.prototype["get"+t(i[l])]=n(i[l]),c.prototype["set"+t(i[l])]=function(e){return function(t){this[e]=String(t)}}(i[l]);return c}()})),yt=mt((function(e,t){var n,r,o,i;e.exports=(n=gt,r=/(^|@)\S+:\d+/,o=/^\s*at .*(\S+:\d+|\(native\))/m,i=/^(eval@)?(\[native code])?$/,{parse:function(e){if(void 0!==e.stacktrace||void 0!==e["opera#sourceloc"])return this.parseOpera(e);if(e.stack&&e.stack.match(o))return this.parseV8OrIE(e);if(e.stack)return this.parseFFOrSafari(e);throw new Error("Cannot parse given Error object")},extractLocation:function(e){if(-1===e.indexOf(":"))return[e];var t=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(e.replace(/[()]/g,""));return[t[1],t[2]||void 0,t[3]||void 0]},parseV8OrIE:function(e){return e.stack.split("\n").filter((function(e){return!!e.match(o)}),this).map((function(e){e.indexOf("(eval ")>-1&&(e=e.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var t=e.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),r=t.match(/ (\(.+\)$)/);t=r?t.replace(r[0],""):t;var o=this.extractLocation(r?r[1]:t),i=r&&t||void 0,a=["eval","<anonymous>"].indexOf(o[0])>-1?void 0:o[0];return new n({functionName:i,fileName:a,lineNumber:o[1],columnNumber:o[2],source:e})}),this)},parseFFOrSafari:function(e){return e.stack.split("\n").filter((function(e){return!e.match(i)}),this).map((function(e){if(e.indexOf(" > eval")>-1&&(e=e.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),-1===e.indexOf("@")&&-1===e.indexOf(":"))return new n({functionName:e});var t=/((.*".+"[^@]*)?[^@]*)(?:@)/,r=e.match(t),o=r&&r[1]?r[1]:void 0,i=this.extractLocation(e.replace(t,""));return new n({functionName:o,fileName:i[0],lineNumber:i[1],columnNumber:i[2],source:e})}),this)},parseOpera:function(e){return!e.stacktrace||e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function(e){for(var t=/Line (\d+).*script (?:in )?(\S+)/i,r=e.message.split("\n"),o=[],i=2,a=r.length;i<a;i+=2){var c=t.exec(r[i]);c&&o.push(new n({fileName:c[2],lineNumber:c[1],source:r[i]}))}return o},parseOpera10:function(e){for(var t=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,r=e.stacktrace.split("\n"),o=[],i=0,a=r.length;i<a;i+=2){var c=t.exec(r[i]);c&&o.push(new n({functionName:c[3]||void 0,fileName:c[2],lineNumber:c[1],source:r[i]}))}return o},parseOpera11:function(e){return e.stack.split("\n").filter((function(e){return!!e.match(r)&&!e.match(/^Error created at/)}),this).map((function(e){var t,r=e.split("@"),o=this.extractLocation(r.pop()),i=r.shift()||"",a=i.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0;i.match(/\(([^)]*)\)/)&&(t=i.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var c=void 0===t||"[arguments not available]"===t?void 0:t.split(",");return new n({functionName:a,args:c,fileName:o[0],lineNumber:o[1],columnNumber:o[2],source:e})}),this)}})})),bt=null,wt=function(){function e(){}return e.prototype.before=function(e,t){var n=this;return new Promise((function(r){return y(n,void 0,void 0,(function(){var n,o,i;return b(this,(function(a){switch(a.label){case 0:if(!ee.plugins||!P.isArray(ee.plugins))return[3,5];a.label=1;case 1:return a.trys.push([1,3,,4]),n=ee.plugins,[4,Ge(n,"before",{type:e,data:t}).start()];case 2:return o=a.sent(),i=o.slice(-1)[0],r(i),[3,4];case 3:return a.sent(),console.warn("bili-mirror:plugin function before hook error,please check"),r(!0),[3,4];case 4:return[3,6];case 5:if(ee.plugins&&ee.plugins.mirrorHandleBefore)try{ee.plugins.mirrorHandleBefore(e,t).then((function(e){r(e)}))}catch(e){console.warn("bili-mirror:plugin function before hook error,please check"),r(!0)}else r(!0);a.label=6;case 6:return[2]}}))}))}))},e.prototype.after=function(e,t){var n=this;return new Promise((function(r){return y(n,void 0,void 0,(function(){var n;return b(this,(function(o){switch(o.label){case 0:if(!ee.plugins||!P.isArray(ee.plugins))return[3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),n=ee.plugins,[4,Ge(n,"after",{type:e,data:t}).start()];case 2:return o.sent(),r(),[3,4];case 3:return o.sent(),console.warn("bili-mirror:plugin function after hook error,please check"),r(),[3,4];case 4:return[3,6];case 5:if(ee.plugins&&ee.plugins.mirrorHandleAfter)try{ee.plugins.mirrorHandleAfter(e,t).then((function(){r()}))}catch(e){console.warn("bili-mirror:plugin function after hook error,please check"),r()}else r();o.label=6;case 6:return[2]}}))}))}))},e}();bt||(bt=new wt);var Et=bt,St=_(),Ot=function(){function e(){this.maxBreadcrumbs=10,this.stack=[]}return e.prototype.push=function(e){return y(this,void 0,void 0,(function(){var t=this;return b(this,(function(n){switch(n.label){case 0:return[4,Et.before(ie.BREABCRUMB,e)];case 1:return n.sent()?(this.immediatePush(e),k(O,"beforeunload",(function(){t.stack.filter((function(e){return"error"===e.status})).length&&(t.goToReport(t.stack),window.__biliMirrorPbInstance__&&window.__biliMirrorPbInstance__.flush&&window.__biliMirrorPbInstance__.flush())})),[2]):[2]}}))}))},e.prototype.immediatePush=function(e){e.time||(e.time=T()),this.stack.length>=this.maxBreadcrumbs&&(this.stack.filter((function(e){return"error"===e.status})).length?(this.goToReport(this.stack),this.clear()):this.clear()),this.stack.push(e),this.stack.sort((function(e,t){return e.time-t.time}))},e.prototype.shift=function(){return void 0!==this.stack.shift()},e.prototype.clear=function(){this.stack=[]},e.prototype.getStack=function(){return this.stack},e.prototype.goToReport=function(e){var t={};e.forEach((function(e,n){t["logStep-".concat(n)]=e})),ft({type:"custom",event:"".concat(ee.origin,".").concat(ee.module,".USERLOG"),msg:g({userLogInfo:g({},t)},qe)}),Et.after(ie.BREABCRUMB,this.stack),this.clear()},e}(),_t=S()?St.breadcrumb||(St.breadcrumb=new Ot):null,Rt=null,kt=function(){function e(){}return e.prototype.handleHistory=function(e){var t=e.from,n=e.to,r=A(t).relative,o=A(n).relative;_t.push({category:ae.HISTORY,status:se.OK,time:T(),msg:{from:r||"/",to:o||"/"}})},e.prototype.handleHashChange=function(e){var t=e.oldURL,n=e.newURL,r=A(t).relative,o=A(n).relative;_t.push({category:ae.HASHCHANGE,status:se.OK,time:T(),msg:{from:r,to:o}})},e.prototype.handleDomClick=function(e){var t=function(e){var t=e.tagName.toLowerCase();if("body"===t)return"";var n=e.classList.value;n=""!==n?" class='".concat(n,"'"):"";var r=e.id?' id="'.concat(e.id,'"'):"",o=e.innerText;return"<".concat(t).concat(r).concat(""!==n?n:"",">").concat(o,"</").concat(t,">")}(e.activeElement);t&&_t.push({category:ae.CLICK,status:se.OK,time:T(),msg:{clickDom:t}})},e.prototype.handleJsError=function(e){_t.push({category:ae.ERROR,status:se.ERROR,time:e.time||T(),msg:{message:e.message}})},e.prototype.handlePromiseError=function(e){_t.push({category:ae.UNHANDLEDREJECTION,status:se.ERROR,time:e.time||T(),msg:{message:e.message}})},e.prototype.handleResourceError=function(e){_t.push({category:ae.RESOURCE,status:se.ERROR,time:e.time||T(),msg:{message:e.message,name:null==e?void 0:e.name}})},e.prototype.handleWhiteScreen=function(){_t.push({category:ae.WHITE,status:se.ERROR,time:T(),msg:{url:location.href}})},e}();Rt||(Rt=new kt);var Tt=Rt,xt=L();function It(e){var t=(null==ee?void 0:ee.config["user-log"])||null;return!!t&&t.find((function(t){return t===e}))}var Pt,Nt={historyReplace:function(){if(It(le.HISTORY)&&(t=(e=O.chrome)&&e.app&&e.app.runtime,n="history"in O&&!!O.history.pushState&&!!O.history.replaceState,!t&&n)){var e,t,n,r=O.onpopstate;O.onpopstate=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=L(),o=xt;xt=n,Tt.handleHistory({from:o,to:n}),r&&r.apply(this,e)},D(O.history,"pushState",o),D(O.history,"replaceState",o)}function o(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=t.length>2?t[2]:void 0;if(r){var o=xt,i=String(r);xt=i,Tt.handleHistory({from:o,to:i})}return e.apply(this,t)}}},hashChangeeReplace:function(){var e;It(le.HASH)&&(e=O,"onhashchange",Object.prototype.hasOwnProperty.call(e,"onhashchange")&&k(O,"hashchange",(function(e){Tt.handleHashChange(e)})))},domClickReplace:function(){if(It(le.DOM)&&"document"in O){var e,t,n,r=(e=Tt.handleDomClick,t=300,n=!0,function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];n&&(e.apply(this,r),n=!1,setTimeout((function(){n=!0}),t))});k(O.document,"click",(function(){r(this)}),!0)}},jsErrorReplace:function(e){It(le.JS)&&(null==Tt||Tt.handleJsError(e))},promiseErrorReplace:function(e){It(le.PROMISE)&&(null==Tt||Tt.handlePromiseError(e))},resourceErrorReplace:function(e){It(le.RESOURCE)&&(null==Tt||Tt.handleResourceError(e))},whiteErrorReplace:function(){It(le.WHITE)&&(null==Tt||Tt.handleWhiteScreen())}},jt=[],Ct=function(e){var t,n=(t=(null==e?void 0:e.message)||(null==e?void 0:e.fileName),window.btoa(decodeURIComponent(encodeURIComponent(t))));return jt.some((function(e){return e===n}))?(console.warn("Duplicate error, not reported,".concat(null==e?void 0:e.message)),!1):(jt.push(n),!0)},Lt={},At={handleError:function(e){var t,n,r,o,i;return y(this,void 0,void 0,(function(){var a,c,s,u,l,f,d;return b(this,(function(p){switch(p.label){case 0:a=e.target,p.label=1;case 1:return p.trys.push([1,7,,8]),!a||e.target&&!e.target.localName?(c=function(e){var t,n=e.target;if(!n||e.target&&!(null===(t=e.target)||void 0===t?void 0:t.localName)){var r=yt.parse(n?e.error:e).slice(0,5),o=[];r.forEach((function(e){var t=e.source,n=t?t.split(" ").join("").split("./"):"";o.push(n)}));var i=yt.parse(n?e.error:e)[0],a=i.fileName,c=i.columnNumber,s=i.lineNumber;return{type:"error",time:T(),message:e.message,fileName:a,line:s,column:c,stack:JSON.stringify(o)}}return null}(e),s=null===(n=null===(t=null==ee?void 0:ee.config)||void 0===t?void 0:t.white)||void 0===n?void 0:n.error,N(c,s)?[3,3]:Ct(c)?[4,Et.before(ie.ERROR,c)]:[2]):[3,3];case 2:if(!p.sent())return[2];ft({type:"error",eventId:"".concat(ee.origin,".").concat(ee.module,".ERROR.jsError"),msg:c},ee.pbOptions||{}),Nt.jsErrorReplace(c),Et.after(ie.ERROR,c),p.label=3;case 3:return(null==a?void 0:a.localName)?(u=function(e){var t=e.target;if(null==t?void 0:t.localName){var n=function(e){return{time:T(),message:e.src||e.href||"",name:e.localName}}(t);return g(g({},n),{type:"resourceError"})}return null}(e),l=null===(o=null===(r=null==ee?void 0:ee.config)||void 0===r?void 0:r.white)||void 0===o?void 0:o.resource,N(u,l)?[3,6]:[4,(h=u,v=null===(i=null==ee?void 0:ee.config)||void 0===i?void 0:i["white-retry"],void 0===v&&(v=[]),y(void 0,void 0,void 0,(function(){return b(this,(function(e){return h.message?(void 0===Lt[h.name]&&(Lt[h.name]=2),Lt[h.name]>0?(Lt[h.name]--,N(h,v)?[2,Promise.resolve({retryResult:"whitelist"})]:[2,new Promise((function(e){(function(e,t){void 0===t&&(t=!0);var n=e.method.toLocaleUpperCase(),r="POST"===n?JSON.stringify(e.data):"",o="GET"===n?function(e){if(!Object.keys(e).length)return"";var t="";for(var n in e)t+="".concat(n,"=").concat(e[n],"&");return t.substring(0,t.length-1)}(e.data):"",i=o?-1!==e.url.indexOf("?")?"".concat(e.url,"&").concat(o):"".concat(e.url,"?").concat(o):e.url;return new Promise((function(o,a){var c=new XMLHttpRequest;if(c.onreadystatechange=function(){if(c.readyState===XMLHttpRequest.DONE)if(200===c.status){var e=null;try{e=JSON.parse(c.responseText)}catch(t){e=c.responseText}o(e)}else{var t=c.getAllResponseHeaders().trim().split(/[\r\n]+/),n={};t.forEach((function(e){var t=e.split(": "),r=t.shift(),o=t.join(": ");n[r]=o})),a({responseText:c.responseText,headers:n,status:c.status})}},c.withCredentials=t,c.open(n,i,!0),"POST"===n&&e.headers&&"object"==typeof e.headers)for(var s in e.headers)c.setRequestHeader(s,e.headers[s]);c.send(r)}))})({url:h.message,method:"GET",data:{},headers:{}},!1).then((function(){e({retryResult:"success"})})).catch((function(t){e(g({retryResult:"failed"},t))}))}))]):[2,Promise.resolve({retryResult:"skip"})]):[2,Promise.resolve({retryResult:"skip"})]}))})))]):[3,6];case 4:return f=p.sent(),u=g(g({},u),f),Ct(u)?[4,Et.before(ie.RESOURCE,u)]:[2];case 5:if(!p.sent())return[2];ft({type:"error",eventId:"".concat(ee.origin,".").concat(ee.module,".ERROR.resourceError"),msg:g(g({},u),{error_type:"AssetsError",headless:""==navigator.language?"headless":"normal",webdriver:null===navigator||void 0===navigator?void 0:navigator.webdriver})},ee.pbOptions||{}),Nt.resourceErrorReplace(u),Et.after(ie.RESOURCE,u),p.label=6;case 6:return[3,8];case 7:return d=p.sent(),console.warn("bili-mirror: handleError-Error parsing failed:",d),[3,8];case 8:return[2]}var h,v}))}))},handleUnhandleRejection:function(e){var t,n;return y(this,void 0,void 0,(function(){var r,o,i;return b(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),r=function(e){var t=yt.parse(e.reason).slice(0,5),n=[];t.forEach((function(e){var t=e.source,r=t?t.split(" ").join("").split("./"):"";n.push(r)}));var r,o=yt.parse(e.reason)[0],i=o.fileName,a=o.columnNumber,c=o.lineNumber;return{type:"rejectionError",time:T(),message:(r=e.reason.message||e.reason.stack,P.isString(r)?r:P.isUndefined(r)?"undefined":JSON.stringify(r)),fileName:i,line:c,column:a,stack:JSON.stringify(n)}}(e),o=null===(n=null===(t=null==ee?void 0:ee.config)||void 0===t?void 0:t.white)||void 0===n?void 0:n.rejection,N(r,o)?[3,2]:Ct(r)?[4,Et.before(ie.UNHANDLEDREJECTION,r)]:[2];case 1:if(!a.sent())return[2];ft({type:"error",eventId:"".concat(ee.origin,".").concat(ee.module,".ERROR.rejectionError"),msg:r},ee.pbOptions||{}),Nt.promiseErrorReplace(r),Et.after(ie.UNHANDLEDREJECTION,r),a.label=2;case 2:return[3,4];case 3:return i=a.sent(),console.warn("bili-mirror: handleUnhandleRejection-Error parsing failed:",i),[3,4];case 4:return[2]}}))}))},handlePerformance:function(){return y(this,void 0,void 0,(function(){var e=this;return b(this,(function(t){try{if(!PerformanceObserver||!(null===PerformanceObserver||void 0===PerformanceObserver?void 0:PerformanceObserver.supportedEntryTypes))return[2];if(C(ee.config["white-preformance-rate"]))return[2];!function(e){/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)?(function(e){if(Ke("first-input")){var t=new PerformanceObserver((function(n){for(var r=0,o=n.getEntries();r<o.length;r++){var i=o[r];t.disconnect();var a=i.processingStart-i.startTime;e({name:"FID",value:a,rating:a<100?"good":a>100&&a<300?"normal":"poor"})}}));t.observe({type:"first-input",buffered:!0})}}((function(t){e(t)})),function(e){if(Ke("paint")){var t=new PerformanceObserver((function(n){for(var r=0,o=n.getEntries();r<o.length;r++){var i=o[r];"first-contentful-paint"===i.name&&(t.disconnect(),e({name:"FCP",value:i.startTime,rating:i.startTime<1600?"good":i.startTime>1600&&i.startTime<3e3?"normal":"poor"}))}}));t.observe({type:"paint",buffered:!0})}}((function(t){e(t)})),function(e){if(Ke("largest-contentful-paint")){var t=new PerformanceObserver((function(n){for(var r=0,o=n.getEntries();r<o.length;r++){var i=o[r];t.disconnect(),e({name:"LCP",value:i.startTime,rating:i.startTime<1600?"good":i.startTime>1600&&i.startTime<3e3?"normal":"poor"})}}));t.observe({type:"largest-contentful-paint",buffered:!0})}}((function(t){e(t)})),function(e){window.addEventListener("load",(function(){var t=window.performance.timing,n=t.responseStart-t.navigationStart;e({name:"TTFB",value:n,rating:n<200?"good":n>200&&n<500?"normal":"poor"})}))}((function(t){e(t)})),Ve((function(t){e(t)}))):(function(e,t){t=t||{},Te((function(){var n,r=ke(),o=ve("LCP"),i=function(e){var t=e[e.length-1];t&&t.startTime<r.firstHiddenTime&&(o.value=Math.max(t.startTime-he(),0),o.entries=[t],n())},a=me("largest-contentful-paint",i);if(a){n=ge(e,o,Me,t.reportAllChanges);var c=we((function(){He[o.id]||(i(a.takeRecords()),a.disconnect(),He[o.id]=!0,n(!0))}));["keydown","click"].forEach((function(e){addEventListener(e,c,!0)})),be(c),de((function(r){o=ve("LCP"),n=ge(e,o,Me,t.reportAllChanges),ye((function(){o.value=performance.now()-r.timeStamp,He[o.id]=!0,n(!0)}))}))}}))}((function(t){e(t)})),function(e,t){t=t||{},Te((function(){var n,r=ke(),o=ve("FID"),i=function(e){e.startTime<r.firstHiddenTime&&(o.value=e.processingStart-e.startTime,o.entries.push(e),n(!0))},a=function(e){e.forEach(i)},c=me("first-input",a);n=ge(e,o,Be,t.reportAllChanges),c&&be(we((function(){a(c.takeRecords()),c.disconnect()}))),c&&de((function(){var r;o=ve("FID"),n=ge(e,o,Be,t.reportAllChanges),oe=[],ne=-1,te=null,De(addEventListener),r=i,oe.push(r),Le()}))}))}((function(t){e(t)})),function(e,t){t=t||{},Ie(we((function(){var n,r=ve("CLS",0),o=0,i=[],a=function(e){e.forEach((function(e){if(!e.hadRecentInput){var t=i[0],n=i[i.length-1];o&&e.startTime-n.startTime<1e3&&e.startTime-t.startTime<5e3?(o+=e.value,i.push(e)):(o=e.value,i=[e])}})),o>r.value&&(r.value=o,r.entries=i,n())},c=me("layout-shift",a);c&&(n=ge(e,r,Pe,t.reportAllChanges),be((function(){a(c.takeRecords()),n(!0)})),de((function(){o=0,r=ve("CLS",0),n=ge(e,r,Pe,t.reportAllChanges),ye((function(){return n()}))})),setTimeout(n,0))})))}((function(t){e(t)})),Ie((function(t){e(t)})),Je((function(t){e(t)})),Ve((function(t){e(t)})))}((function(t){return y(e,void 0,void 0,(function(){var e,n;return b(this,(function(r){switch(r.label){case 0:return e=t.name,!(n=t.value)||n<0?[2]:[4,Et.before(ie.PERFORMANCE,t)];case 1:return r.sent()?(ft({type:"performance",eventId:"".concat(ee.origin,".").concat(ee.module,".PERFORMANCE.").concat(t.name),msg:g({},"PAGETIME"===e?null==t?void 0:t.data:t)},ee.pbOptions||{}),Et.after(ie.PERFORMANCE,t),[2]):[2]}}))}))}))}catch(e){console.warn("bili-mirror: performance-Error parsing failed:",e)}return[2]}))}))}};!function(e){e.ERROR="error",e.OK="ok"}(Pt||(Pt={}));var Dt=null,Bt=null,Mt="BILI_MIRROR_RESOURCE_TIME",Ht=["xmlhttprequest","fetch","img","image","link","css","video","iframe","script"],Ut={API:"xmlhttprequest,fetch",IMG:"img,image",CSS:"link,css",JS:"script",VIDEO:"video",IFRAME:"iframe"},Ft=function(){function e(){this._cleanUpReportPool=function(){Dt&&Dt.clear(),window.__biliMirrorPbInstance__&&window.__biliMirrorPbInstance__.flush&&window.__biliMirrorPbInstance__.flush()},this.config=ee.config["resource-time"]||{},this.resourceWaitList=[],this.disablePush=!1}return e.prototype.on=function(){PerformanceObserver&&(null===PerformanceObserver||void 0===PerformanceObserver?void 0:PerformanceObserver.supportedEntryTypes)&&(this._getAllData(),this._createObserver())},e.prototype.destroy=function(){Bt&&Bt.disconnect(),Dt&&Dt.clear()},e.prototype._getAllData=function(){var e=this,t=performance.getEntriesByType("resource");(t||t.length)&&t.forEach((function(t){e.resourceWaitList.push(t)}))},e.prototype._handlerResourceInit=function(){for(this.disablePush=!0;this.resourceWaitList.length;){var e=this.resourceWaitList.shift();if(this._isCheckResource(e)){var t=this._computeResourceData_(e);this._addResourceReportPool(t)}}this.disablePush=!1,this._startReportInterval()},e.prototype._isCheckResource=function(e){if(!Ht.includes(e.initiatorType))return!1;if(!Object.keys(this.config).length)return!1;var t=!1;for(var n in this.config)if(Ut[n].split(",").includes(e.initiatorType)){if("*"===this.config[n]){t=!0;break}if(!this.config[n])continue;if(Array.isArray(this.config[n])&&this.config[n].length)for(var r=0;r<this.config[n].length;r++)if(e.name.split("?")[0].match(this.config[n][r])){t=!0;break}}return t},e.prototype._computeResourceData_=function(e){var t=e.name.split("?"),n=e.transferSize,r=e.initiatorType,o=e.duration,i=e.nextHopProtocol,a=e.redirectStart,c=e.redirectEnd,s=e.domainLookupEnd,u=e.domainLookupStart,l=e.connectEnd,f=e.connectStart,d=e.secureConnectionStart,p=e.responseStart,h=e.requestStart,v=e.responseEnd;return{url:t[0],query:t[1],duration:o.toFixed(2),size:n,type:r,protocol:i,redirectTime:c-a,dnsTime:s-u,sslTime:l-d,tcpTime:l-f,requestTime:p-h,responseTime:v-p}},e.prototype._addResourceReportPool=function(e){var t=JSON.parse(localStorage.getItem(Mt)||"{}"),n=e.url;t[n]||(t[n]=g({},e)),localStorage.setItem(Mt,JSON.stringify(t))},e.prototype._startReportInterval=function(){var e=this;Dt||((Dt=new $e).repeat(this._clearResourceReport,18e4),k(O,"beforeunload",(function(){e._clearResourceReport(),e._cleanUpReportPool()})))},e.prototype._clearResourceReport=function(){try{var e=JSON.parse(localStorage.getItem(Mt)||"{}");Object.keys(e).length&&ft({type:"performance",eventId:"".concat(ee.origin,".").concat(ee.module,".PERFORMANCE.RESOURCETIME"),msg:{resourceListInfo:g({},e)}}),localStorage.setItem(Mt,"")}catch(e){}},e.prototype._createObserver=function(){var e=this;(Bt=new PerformanceObserver((function(t){t.getEntries().forEach((function(t){e.resourceWaitList.push(t.toJSON())})),e.disablePush||e._handlerResourceInit()}))).observe({entryTypes:["resource"]})},e}();var Jt,Kt=function(e){void 0===e&&(e={});var t=null==ee?void 0:ee.config["tech-pv"];if(t&&!C(t)){var n="".concat(ee.origin,".").concat(ee.module,".TECHPV.0.0");ft({eventId:n,type:"custom",msg:g(g({},e),qe)})}},Vt=_(),qt=function(e){S()&&ft(e)};function Wt(e){var t=this;S()&&(Vt.isInited||(Vt.isInited=!0,Vt.mirrorInitMode||(Vt.mirrorInitMode=ue.DEFAULT),function(e){return void 0===e&&(e={}),y(this,void 0,void 0,(function(){return b(this,(function(t){switch(t.label){case 0:return S()?[4,ee.bindOptions(e)]:[3,2];case 1:return[2,t.sent()];case 2:return[2]}}))}))}(e).then((function(){return y(t,void 0,void 0,(function(){return b(this,(function(t){switch(t.label){case 0:return[4,Et.before(ie.INIT,e)];case 1:return t.sent()?(function(e){var t;if(S()){if(k(O,"error",(function(e){At.handleError(e)}),!0),k(O,"unhandledrejection",(function(e){At.handleUnhandleRejection(e)})),At.handlePerformance(),null==e?void 0:e.whiteScreen)try{!function(e){if(!((null==O?void 0:O.screen.width)<=0||O.screen.height<=0||(null==O?void 0:O.innerWidth)<=0||O.innerHeight<=0)){var t=e.checkNum||3,n=e.maxLoop||9,r=e.elemArry||e.checkDom||["html","body","#app"],o=e.callback||function(){},i=_(),a=0,c=[],s=[],u={};e.isSkeleton?"complete"!=document.readyState&&d():"complete"===document.readyState?d():O.addEventListener("load",d)}function l(e){return e.id?"#"+e.id:e.className&&"string"==typeof e.className?"."+e.className.split(" ").filter((function(e){return!!e})).join("."):e.nodeName.toLowerCase()}function f(t){var n=l(t);e.isSkeleton&&(a?s.push(n):c.push(n));var o=!1;if(!n||!r)return o;for(var i=0;i<=r.length;i++)if(r[i]&&n.match(r[i])){o=!0;break}return o}function d(){return y(this,void 0,void 0,(function(){var d,h,v,m,y,w,E,S,_,R,k,T;return b(this,(function(b){switch(b.label){case 0:return document&&document.elementsFromPoint?[4,Et.before(ie.WHITESCREEN)]:(console.warn("当前浏览器不支持elementsFromPoint方法,白屏检测跳过"),[2]);case 1:if(!b.sent())return[2];for(u.check_list=r,d=!0,h=1;h<=7;h+=3){if(v=O.innerWidth*h/10,m=O.innerHeight/2,y=O.innerWidth/2,w=O.innerHeight*h/10,E=document.elementsFromPoint(v,m),S=document.elementsFromPoint(y,w),E.length>t){for(_=[],u["pointX-".concat(v,"-").concat(m)]||(u["pointX-".concat(v,"-").concat(m)]=[]),R=0;R<E.length;R++)if(_.push(l(E[R])),f(E[R])){d=!1;break}u["pointX-".concat(v,"-").concat(m)].length||(u["pointX-".concat(v,"-").concat(m)]=_)}if(!d)break;if(d&&S.length>t&&5!=h){for(k=[],u["pointY-".concat(y,"-").concat(w)]||(u["pointY-".concat(y,"-").concat(w)]=[]),T=0;T<S.length;T++)if(k.push(l(S[T])),f(S[T])){d=!1;break}u["pointY-".concat(y,"-").concat(w)].length||(u["pointY-".concat(y,"-").concat(w)]=k)}if(!d)break}if(d)p();else{if(e.isSkeleton){if(!a)return[2,p()];if(s.join()==c.join())return[2,o({status:Pt.ERROR})]}i._loopTimer&&clearTimeout(i._loopTimer),i._loopTimer=null}return o({status:d?Pt.ERROR:Pt.OK,loop:a,data:g({},u)}),a>=n&&(ft({type:"error",eventId:"".concat(ee.origin,".").concat(ee.module,".ERROR.whiteScreen"),msg:{_BiliCheckDom_Point:g({},u)}}),Nt.whiteErrorReplace()),Et.after(ie.WHITESCREEN,g({},u)),[2]}}))}))}function p(){a>=n&&i._loopTimer?(clearTimeout(i._loopTimer),i._loopTimer=null):i._loopTimer=setTimeout((function(){a++,e.isSkeleton&&(s=[]),d()}),1e3)}}(e.whiteScreen)}catch(e){console.error("bili-mirror: whiteScreen错误解析异常:",e)}if(null===(t=null==ee?void 0:ee.config["user-log"])||void 0===t?void 0:t.length)try{Nt.historyReplace(),Nt.hashChangeeReplace(),Nt.domClickReplace()}catch(e){console.error("bili-mirror:user-log记录解析异常",e)}ee.config["resource-time"]&&Object.keys(ee.config["resource-time"]).length&&k(O,"load",(function(){var e=new Ft;try{e.on()}catch(t){e.destroy(),console.warn("bili-mirror:resource-watch error",t)}}))}}(null==e?void 0:e.config),Kt(),Et.after(ie.INIT,e),console.info("%c%s","line-height: 30px; color: #FF6699","bili-fe-mirror:".concat(M)),[2]):[2]}}))}))}))))}if(S()){window.__INITIAL_MIRROR__=Wt;var Gt=window.__MIRROR_CONFIG__,$t=null===(Jt=null==Gt?void 0:Gt.config)||void 0===Jt?void 0:Jt.isAutoInit;Gt&&P.isObject(Gt)&&$t&&(!Vt.mirrorInitMode&&(Vt.mirrorInitMode=ue.AUTO),Wt(Gt))}var zt={SDK_NAME:"@bilibili/bili-mirror",SDK_VERSION:M,init:Wt,install:function(e,t){void 0===t&&(t={});var n=e.config.errorHandler;e.config.errorHandler=function(e,t,r){At.handleError(e),n&&n.apply(null,[e,t,r]),console.error(e)},Wt(t)},errorBoundary:function(e){At.handleError(e)}},Yt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Qt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Xt(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var n=function e(){if(this instanceof e){var n=[null];return n.push.apply(n,arguments),new(Function.bind.apply(t,n))}return t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})})),n}var Zt={exports:{}};var en,tn={exports:{}},nn=Xt(Object.freeze({__proto__:null,default:{}}));function rn(){return en||(en=1,function(e,t){var n;e.exports=(n=n||function(e,t){var n;if("undefined"!=typeof window&&window.crypto&&(n=window.crypto),"undefined"!=typeof self&&self.crypto&&(n=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(n=globalThis.crypto),!n&&"undefined"!=typeof window&&window.msCrypto&&(n=window.msCrypto),!n&&void 0!==Yt&&Yt.crypto&&(n=Yt.crypto),!n)try{n=nn}catch(e){}var r=function(){if(n){if("function"==typeof n.getRandomValues)try{return n.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof n.randomBytes)try{return n.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),i={},a=i.lib={},c=a.Base={extend:function(e){var t=o(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},s=a.WordArray=c.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,o=e.sigBytes;if(this.clamp(),r%4)for(var i=0;i<o;i++){var a=n[i>>>2]>>>24-i%4*8&255;t[r+i>>>2]|=a<<24-(r+i)%4*8}else for(var c=0;c<o;c+=4)t[r+c>>>2]=n[c>>>2];return this.sigBytes+=o,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=c.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(r());return new s.init(t,e)}}),u=i.enc={},l=u.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o++){var i=t[o>>>2]>>>24-o%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new s.init(n,t/2)}},f=u.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o++){var i=t[o>>>2]>>>24-o%4*8&255;r.push(String.fromCharCode(i))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new s.init(n,t)}},d=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(f.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return f.parse(unescape(encodeURIComponent(e)))}},p=a.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,r=this._data,o=r.words,i=r.sigBytes,a=this.blockSize,c=i/(4*a),u=(c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0))*a,l=e.min(4*u,i);if(u){for(var f=0;f<u;f+=a)this._doProcessBlock(o,f);n=o.splice(0,u),r.sigBytes-=l}return new s.init(n,l)},clone:function(){var e=c.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});a.Hasher=p.extend({cfg:c.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}});var h=i.algo={};return i}(Math),n)}(tn,tn.exports)),tn.exports}tn.exports,function(e,t){var n;e.exports=(n=rn(),function(e){var t=n,r=t.lib,o=r.WordArray,i=r.Hasher,a=t.algo,c=[],s=[];!function(){function t(t){for(var n=e.sqrt(t),r=2;r<=n;r++)if(!(t%r))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var r=2,o=0;o<64;)t(r)&&(o<8&&(c[o]=n(e.pow(r,.5))),s[o]=n(e.pow(r,1/3)),o++),r++}();var u=[],l=a.SHA256=i.extend({_doReset:function(){this._hash=new o.init(c.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],o=n[1],i=n[2],a=n[3],c=n[4],l=n[5],f=n[6],d=n[7],p=0;p<64;p++){if(p<16)u[p]=0|e[t+p];else{var h=u[p-15],v=(h<<25|h>>>7)^(h<<14|h>>>18)^h>>>3,m=u[p-2],g=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;u[p]=v+u[p-7]+g+u[p-16]}var y=r&o^r&i^o&i,b=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),w=d+((c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25))+(c&l^~c&f)+s[p]+u[p];d=f,f=l,l=c,c=a+w|0,a=i,i=o,o=r,r=w+(b+y)|0}n[0]=n[0]+r|0,n[1]=n[1]+o|0,n[2]=n[2]+i|0,n[3]=n[3]+a|0,n[4]=n[4]+c|0,n[5]=n[5]+l|0,n[6]=n[6]+f|0,n[7]=n[7]+d|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,o=8*t.sigBytes;return n[o>>>5]|=128<<24-o%32,n[14+(o+64>>>9<<4)]=e.floor(r/4294967296),n[15+(o+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=i._createHelper(l),t.HmacSHA256=i._createHmacHelper(l)}(Math),n.SHA256)}(Zt);var on=Qt(Zt.exports),an={exports:{}};!function(e,t){var n;e.exports=(n=rn(),function(){var e=n,t=e.lib.WordArray;function r(e,n,r){for(var o=[],i=0,a=0;a<n;a++)if(a%4){var c=r[e.charCodeAt(a-1)]<<a%4*2|r[e.charCodeAt(a)]>>>6-a%4*2;o[i>>>2]|=c<<24-i%4*8,i++}return t.create(o,i)}e.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();for(var o=[],i=0;i<n;i+=3)for(var a=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,c=0;c<4&&i+.75*c<n;c++)o.push(r.charAt(a>>>6*(3-c)&63));var s=r.charAt(64);if(s)for(;o.length%4;)o.push(s);return o.join("")},parse:function(e){var t=e.length,n=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var i=0;i<n.length;i++)o[n.charCodeAt(i)]=i}var a=n.charAt(64);if(a){var c=e.indexOf(a);-1!==c&&(t=c)}return r(e,t,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),n.enc.Base64)}(an);var cn=Qt(an.exports),sn=Object.defineProperty,un=Object.defineProperties,ln=Object.getOwnPropertyDescriptors,fn=Object.getOwnPropertySymbols,dn=Object.prototype.hasOwnProperty,pn=Object.prototype.propertyIsEnumerable,hn=(e,t,n)=>t in e?sn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,vn=(e,t)=>{for(var n in t||(t={}))dn.call(t,n)&&hn(e,n,t[n]);if(fn)for(var n of fn(t))pn.call(t,n)&&hn(e,n,t[n]);return e},mn=(e,t)=>un(e,ln(t));const gn="object"==typeof window,yn=gn?window:null;if(yn){if(!yn.selfBrowser){const e=()=>{const e=navigator.userAgent;return!(!/ OS \d/.test(e)||~e.indexOf("CriOS")||e.indexOf("Mozilla")||!/Safari\/[\d.]+$/.test(e))};yn.selfBrowser={version:function(){const t=navigator.userAgent;return{mobile:/AppleWebKit.*Mobile.*/i.test(t),ios:/\(i[^;]+;( U;)? CPU.+Mac OS X/i.test(t),android:/Android/i.test(t)||/Linux/i.test(t),windowsphone:/Windows Phone/i.test(t),iPhone:/iPhone/i.test(t),iPad:/iPad/i.test(t),webApp:!/Safari/i.test(t),MicroMessenger:/MicroMessenger/i.test(t),weibo:/Weibo/i.test(t),uc:/UCBrowser/i.test(t),qq:/MQQBrowser/i.test(t),baidu:/Baidu/i.test(t),mqq:/QQ\/([\d.]+)/i.test(t),mbaidu:/baiduboxapp/i.test(t),iqiyi:/iqiyi/i.test(t),QQLive:/QQLive/i.test(t),Safari:e(),Youku:/youku/i.test(t),chrome:/CriOS/i.test(t),CMDC:/CMDC/i.test(t),BiliApp:/BiliApp|BiliComic|hikari/i.test(t),BiliMallSDK:/mallSdkVersion/i.test(t),BiliHikari:/hikari/i.test(t),bStar:/bstar_/i.test(t)}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()}}yn.BiliJsBridge||(yn.BiliJsBridge={sendTasks:[],callbacks:[],biliInject:null,selfCallbackId:1,inited:!1,newVersion:!1})}const bn=gn?navigator.userAgent:null,wn=!!gn&&/BiliApp|BiliComic|hikari/i.test(bn);let En=[];function Sn(e){yn.BiliJsBridge.biliInject.biliCallbackReceived||(yn.BiliJsBridge.biliInject.biliCallbackReceived=function(e,t,n){const r=yn.BiliJsBridge.callbacks.map((e=>e.callbackId)).indexOf(Number(e));if(r>=0){const e=yn.BiliJsBridge.callbacks[r];if("global.import"===e.method&&(En=[]),"function"==typeof e.callback&&(e.callback(n||t),e.messageWindow)){let r=n;n instanceof Error&&(r={message:n.message,stack:n.stack});const o=JSON.stringify({jsbReceiveId:e.callbackId,jsbReceiveArgs:r||t});e.messageWindow.postMessage(o,"*")}}});const t=[];for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&"function"==typeof e[n]&&"callback"!==n&&(t.push({callback:e[n],callbackId:yn.BiliJsBridge.selfCallbackId,callbackName:n,messageWindow:e.messageWindow}),e[n]="",e.data[n+"CallbackId"]=yn.BiliJsBridge.selfCallbackId++);if(t.push({method:e.method,callback:e.callback,callbackId:yn.BiliJsBridge.selfCallbackId,callbackName:"callback",messageWindow:e.messageWindow}),yn.BiliJsBridge.callbacks.push(...t),e.msgCallbackId&&e.messageWindow){const n=JSON.stringify({msgCallbackId:e.msgCallbackId,callbacks:t.map((e=>({callbackId:e.callbackId,callbackName:e.callbackName})))});e.messageWindow.postMessage(n,"*")}let n;n=yn.BiliJsBridge.biliInject&&"function"==typeof yn.BiliJsBridge.biliInject.postMessage?yn.BiliJsBridge.biliInject.postMessage.bind(yn.BiliJsBridge.biliInject):()=>{},yn.selfBrowser.version.android?n(JSON.stringify({method:e.method,data:Object.assign(e.data,{callbackId:yn.BiliJsBridge.selfCallbackId++})})):n({method:e.method,data:JSON.stringify(Object.assign(e.data,{callbackId:yn.BiliJsBridge.selfCallbackId++}))})}function On(e){if("global.import"===e.method&&(En=[]),(e=e||{}).data=e.data||{},!e.method)throw new Error("no method");yn.BiliJsBridge.inited?yn.BiliJsBridge.newVersion&&Sn(e):yn.BiliJsBridge.sendTasks.push(e)}function _n(e){e&&e.method&&Rn(e.method).then((t=>{t&&On(e)}))}function Rn(e){return new Promise(((t,n)=>{En.length?t(En.includes(e)):On({method:"global.getAllSupport",callback(r){try{r&&r.length&&(En=r),t(r.includes(e))}catch(e){n(e)}}})}))}function kn(){return yn&&(yn.biliInject||yn.webkit&&yn.webkit.messageHandlers&&yn.webkit.messageHandlers.biliInject)}function Tn(){let e=[];[].forEach.call(arguments,(t=>{t instanceof Array?e=e.concat(t):"string"==typeof t&&e.push(t)})),Rn("global.import").then((t=>{t&&e.forEach((e=>{On({method:"global.import",data:{namespace:e}})}))}))}const xn={},In={};gn&&window.addEventListener("message",(function(e){if(!e.data)return;let t={};try{t=JSON.parse(e.data)}catch(e){}if(!t||!t.msgCallbackId&&!t.jsbReceiveId)return;const n=t.msgCallbackId,r=xn[n];if(r)return"function"==typeof r&&r(t),void delete xn[t.msgCallbackId];if(t.jsbReceiveId){const e=In[t.jsbReceiveId];return void("function"==typeof e&&e(t.jsbReceiveArgs))}const o=e.source,i=t.method,a=t.option||{};switch(i){case"isSupport":return void Rn(t.api).then((e=>{o.postMessage(JSON.stringify(mn(vn({},t),{support:e})),"*")})).catch((()=>{o.postMessage(JSON.stringify(mn(vn({},t),{support:!1})),"*")}));case"callNative":case"callNativeSafe":for(const e in a)"jsbCallbackFn"===a[e]&&(a[e]=()=>{});return a.messageWindow=o,a.msgCallbackId=n,void("callNative"===i?On(a):_n(a));case"importNameSpace":Tn(...t.namespaces),o.postMessage(JSON.stringify(t),"*")}}));let Pn=function(){return new Promise(((e,t)=>{if(kn())t();else if(yn.selfBrowser.version.ios){const e=setInterval((()=>{kn()&&(t(),clearInterval(e))}),1e3)}else setTimeout((()=>{kn()&&t()}),2e3)})).catch((()=>{yn.BiliJsBridge.biliInject=kn(),yn.BiliJsBridge.newVersion=!0,yn.BiliJsBridge.inited=!0,yn.BiliJsBridge.sendTasks.forEach((e=>Sn(e))),yn.BiliJsBridge.sendTasks=[]}))},Nn=Rn,jn=On,Cn=_n,Ln=Tn;if(gn&&window!==window.parent&&window.top){const e=(e,t)=>{e.msgCallbackId=Math.random(),xn[e.msgCallbackId]=t||(()=>{}),window.top.postMessage(JSON.stringify(e),"*")};Pn=()=>{},Nn=t=>new Promise(((n,r)=>{e({method:"isSupport",api:t},(({support:e})=>n(e)))}));const t=(t,n)=>{const r=vn({},n);for(const e in r)"function"==typeof r[e]&&(r[e]="jsbCallbackFn");e({method:t,option:r},(({callbacks:e})=>{(e||[]).forEach((e=>{In[e.callbackId]=n[e.callbackName]}))}))};jn=e=>t("callNative",e),Cn=e=>t("callNativeSafe",e),Ln=(...t)=>e({method:"importNameSpace",namespaces:t})}const An={inBiliApp:wn,initEnv:Pn,isSupport:Nn,callNative:jn,callNativeSafe:Cn,importNameSpace:Ln,isNewJsBridge:kn};var Dn={"log-2017":"//s1.hdslb.com/bfs/seed/log/report/log-reporter.js",meta:"//s1.hdslb.com/bfs/seed/log/meta/reporter.js","game-2018":"//static-mobilegame-1.biligame.net/js/lib/bili-log-report/1.4.0/bili-log-report.js?v=685","game-2021":"//static-mobilegame-1.biligame.net/js/lib/bili-log-report/biligame-log-v3.min.js?v=6.56.0",pb:"//s1.hdslb.com/bfs/seed/jinkela/short/reporter-pb/index.js"};function Bn(){var e=navigator.userAgent.toLowerCase();return/ipad|iphone os|midp|rv:1.2.3.4|ucweb|android|windows ce|windows mobile/.test(e)?2:1}function Mn(e){var t,n;return null!==(t=null===(n=RegExp("[;\\s]*".concat(e,"=([^;\\s]+)")).exec(document.cookie))||void 0===n?void 0:n[1])&&void 0!==t?t:""}function Hn(e){for(var t=document.getElementsByTagName("meta"),n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n].getAttribute("content")||"";return""}function Un(){return Hn("spm_prefix")}function Fn(){var e="online";switch(Hn("spm_ptype")){case"3":e="offline";break;case"1":e="pc";break;case"2":e="h5";break;default:e="online"}return e}function Jn(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1).match(t);return null!=n?unescape(n[2]):null}function Kn(e,t){var n={};e.replace(/\??(\w+)=([^&]*)&?/g,(function(e,t,r){if(void 0!==n[t]){var o=n[t];n[t]=[].concat(o,r)}else n[t]=r;return""}));var r=n[t];return Array.isArray(r)&&r.length?r[0]:"string"==typeof r?r:""}function Vn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(n,r){var o=document.head||document.getElementsByTagName("head")[0],i=document.createElement("script");i.type="text/javascript",i.charset="utf8",i.async=t.async||!1,i.crossOrigin=t.crossOrigin||"anonymous",i.src=e,i.onload=function(){this.onerror=this.onload=null,n()},i.onerror=function(){r()},o.appendChild(i)}))}function qn(e){try{var t="string"==typeof e?JSON.parse(e):e||{};return JSON.stringify(t)}catch(t){return JSON.stringify(e)}}function Wn(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"s1.hdslb.com",n=new RegExp("[?&]".concat(e,"=([^&]*)")),r=document.querySelectorAll('script[src*="/game-report/index.js"]'),o=0;o<r.length;o++){var i=r[o].getAttribute("src");if(i&&i.includes(t)){var a=i.match(n);if(a)return decodeURIComponent(a[1])}}return""}function Gn(e){return $n.apply(this,arguments)}function $n(){return($n=a(r().mark((function e(t){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.split(".").map((function(e){return Dn[e]})).filter((function(e){return e})),e.next=3,Promise.all(n.map((function(e){return Vn(e)})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var zn=!1;function Yn(){return Qn.apply(this,arguments)}function Qn(){return(Qn=a(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(wn){e.next=2;break}return e.abrupt("return",!1);case 2:if(!zn){e.next=4;break}return e.abrupt("return",!0);case 4:return e.next=6,Pn();case 6:return zn=!0,e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Xn,Zn=!1;function er(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Zn)return!1;var t=window.location.href,n={sourcefrom:"",sourceFrom:"",source:"",from_spmid:""},r=Object.keys(n);return r.forEach((function(r){var o=Kn(t,r);!o&&e[r]&&(o=e[r]),o&&(n[r]=o)})),document.body.addEventListener("click",(function(e){var t=e.target;if(t&&"A"===t.tagName){var o=t.getAttribute("href")||"";if(o&&/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9\u4E00-\u9FA5()!@:%_+.~#?&//=]*)/.test(o)){var i=!1;r.forEach((function(e){!Kn(o,e)&&n[e]&&(o=function(e,t,n){var r=new URL(e);return r.searchParams.set(t,n),r.toString()}(o,e,n[e]),i=!0)})),i&&t.setAttribute("href",o)}}})),Zn=!0,!0}var tr=new Promise((function(e){Xn=e})),nr=!1;function rr(){return or.apply(this,arguments)}function or(){return or=a(r().mark((function e(){var t,o,i,a,c,s,u=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.length>0&&void 0!==u[0]?u[0]:{},o=null,window.ReporterPb){e.next=13;break}if(!nr){e.next=8;break}return e.next=6,tr;case 6:e.next=13;break;case 8:return nr=!0,e.next=11,Vn(Dn.pb);case 11:Xn(),nr=!1;case 13:return window.ReporterPb&&(c=n({autoPv:!1,feature:{tech:!0}},t),"1"===Jn("GAME_SDK_DEBUG_TEST_CHANNEL")&&(c=n(n({},c),{},{DEBUG_TEST_CHANNEL:!0})),(s=null===(i=window.reportConfig)||void 0===i||null===(a=i.commonData)||void 0===a?void 0:a.activity_group_id)&&(c.extra=n(n({},c.extra),{},{gpid:s})),o=new window.ReporterPb(c)),e.abrupt("return",o);case 15:case"end":return e.stop()}}),e)}))),or.apply(this,arguments)}function ir(){return ar.apply(this,arguments)}function ar(){return ar=a(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=rr(),window.__biliMirrorPbInstance__){e.next=5;break}return e.next=4,t;case 4:window.__biliMirrorPbInstance__=e.sent;case 5:return e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)}))),ar.apply(this,arguments)}var cr,sr=["pv","pv_unload","click","exposure","appear","tech"];function ur(e,t){return lr.apply(this,arguments)}function lr(){return lr=a(r().mark((function e(t,o){var i,a,c,s,u,l=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=l.length>2&&void 0!==l[2]?l[2]:{},sr.includes(t)||console.warn("unrecognized type: %s",t),cr){e.next=6;break}return e.next=5,rr();case 5:cr=e.sent;case 6:return c=t,"appear"===t?c="exposure":"tech"===t&&(a=n({type:"custom"},a)),s=null===(i=cr)||void 0===i?void 0:i.report(c,o,a),a.flush&&(null===(u=cr)||void 0===u||u.flush()),e.abrupt("return",s);case 11:case"end":return e.stop()}}),e)}))),lr.apply(this,arguments)}var fr,dr=["chrome-extension","Reached maximum"],pr=["wiki.biligame.com","open.biligame.com","www.biligame.com","app.biligame.com"],hr=["creator.biligame.com"],vr=Un(),mr=location.href,gr=new Set,yr="game",br="common",wr="".concat(yr,".").concat(br,".ERROR"),Er="";function Sr(e){var t={message:e.message.substring(0,200)};e.stack&&Object.assign(t,{stack:e.stack.substring(0,350)});var n=function(){if(Er)return Er;var e=(window.reportConfig||{}).commonData||{},t=e.activity_name,n=void 0===t?"":t,r=e.activity_group_id,o=void 0===r?"":r,i=e.activity_type,a=void 0===i?"":i,c=e.page_start_dt,s=void 0===c?"":c,u=e.page_end_dt;return(Er=[n,o,a,s,void 0===u?"":u].filter(Boolean).join("_"))||(Er="".concat(document.title,"_non_activity")),Er}();if(n){var r=t.stack||e.message||"";r&&(r=" "+r),r="".concat(n," ").concat(mr).concat(r),Object.assign(t,{stack:r})}return e.filename&&Object.assign(t,{fileName:e.filename}),e.fileName&&Object.assign(t,{fileName:e.fileName}),e.type&&Object.assign(t,{type:e.type}),e.name&&Object.assign(t,{name:e.name}),e.lineno&&Object.assign(t,{line:e.lineno}),e.line&&Object.assign(t,{line:e.line}),e.colno&&Object.assign(t,{column:e.colno}),e.column&&Object.assign(t,{column:e.column}),e.time&&Object.assign(t,{time:e.time}),t}function Or(e){if(!e.fileName)return!1;gr.size>1e3&&gr.clear();var t="".concat(e.message).concat(e.stack||"").concat(e.fileName);return t=t.replace(/\s/g,""),gr.has(t)?(console.warn("Ignored duplicate error:",t),!0):(gr.add(t),!1)}function _r(e){for(var t=(null==e?void 0:e.message)||(null==e?void 0:e.fileName)||"",n=0;n<dr.length;n++){var r=dr[n];if(t.includes(r))return console.warn("Ignored error from ".concat(r,":"),t),!0}return!1}function Rr(e){return kr.apply(this,arguments)}function kr(){return kr=a(r().mark((function e(t){var n,o,i,a=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:"jsError",t&&t.message){e.next=4;break}return console.warn("Failed to parse:",t),e.abrupt("return");case 4:if(o="".concat(wr,".").concat(n),!_r(i=Sr(t))){e.next=8;break}return e.abrupt("return");case 8:if(!Or(i)){e.next=10;break}return e.abrupt("return");case 10:if(fr||(fr=rr()),window.__biliMirrorPbInstance__){e.next=15;break}return e.next=14,fr;case 14:window.__biliMirrorPbInstance__=e.sent;case 15:qt({eventId:o,type:"error",msg:i,otherSpmId:vr});case 16:case"end":return e.stop()}}),e)}))),kr.apply(this,arguments)}function Tr(e){var t=location.origin+location.pathname,n=t+location.search,r=location.href,o=[mr,t,n,r],i=e.target;if(!e.message&&i&&i.localName){var a=i.src||i.href||"";return o.some((function(e){return a===e}))?(console.warn("Fitered ResourceError:",e),!1):(Rr({message:a},"resourceError"),!0)}return!1}function xr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(Array.isArray(e)&&e.length)return e;var t=["#app","#root","#home"];switch(Un()){case"555.77":t.push("#__main",".bui-container",".swiper-container");break;case"555.184":t.push(".top-warp",".swiper",".home",".content",".bili-game-footer");break;case"555.43":t.push(".main-body",".pcr-theme",".fp-viewing-kv",".slide-page");break;case"555.178":t.push(".B-Policy");break;case"555.44":t.push(".long-page");break;case"555.186":t.push(".root")}return t=d(new Set(t))}function Ir(){return Pr.apply(this,arguments)}function Pr(){return Pr=a(r().mark((function e(){var t,n,o,i,a,c=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:{},n=pr.some((function(e){return mr.includes(e)})),o=hr.some((function(e){return mr.includes(e)})),n&&(br="center"),o&&(br="dev"),wr="game.".concat(br,".ERROR"),window.addEventListener("error",(function(e){Tr(e)||e&&e.message&&"Script error."===e.message&&Rr(e,"jsError")}),!1),e.next=9,rr();case 9:fr=e.sent,window.GAME_PB_INS||(window.GAME_PB_INS=fr),window.__biliMirrorPbInstance__||(window.__biliMirrorPbInstance__=fr),i={checkNum:3,maxLoop:9,checkDom:xr(t.checkDom),isSkeleton:!1},a={origin:yr,module:br,config:{whiteScreen:i},pbOtherNameIns:"GAME_PB_INS"},zt.init(a);case 15:case"end":return e.stop()}}),e)}))),Pr.apply(this,arguments)}let Nr;const jr=new Uint8Array(16);function Cr(){if(!Nr&&(Nr="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Nr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Nr(jr)}const Lr=[];for(let e=0;e<256;++e)Lr.push((e+256).toString(16).slice(1));var Ar={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Dr(e,t,n){if(Ar.randomUUID&&!t&&!e)return Ar.randomUUID();const r=(e=e||{}).random||(e.rng||Cr)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return(Lr[e[t+0]]+Lr[e[t+1]]+Lr[e[t+2]]+Lr[e[t+3]]+"-"+Lr[e[t+4]]+Lr[e[t+5]]+"-"+Lr[e[t+6]]+Lr[e[t+7]]+"-"+Lr[e[t+8]]+Lr[e[t+9]]+"-"+Lr[e[t+10]]+Lr[e[t+11]]+Lr[e[t+12]]+Lr[e[t+13]]+Lr[e[t+14]]+Lr[e[t+15]]).toLowerCase()}(r)}function Br(e,t){if(e&&e.length)return new Promise((function(n,r){var o,i=new XMLHttpRequest;i.withCredentials=!0,i.onreadystatechange=function(){if(4===i.readyState){var e=i.status;if(e>=200&&e<300){var t;try{t=JSON.parse(i.responseText)}catch(e){t=i.responseText}n(t)}else r(e)}},i.open("POST","//line3-log.biligame.net/collector/api/report",!0),i.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),i.setRequestHeader("L-App-Id",t),i.setRequestHeader("L-Topic-Id","1"),i.setRequestHeader("L-Sign",(o=e,cn.stringify(on(JSON.stringify(o))))),i.send(JSON.stringify({logs:e}))}))}var Mr={pv:1,click:2,appear:3,sys:4,perf:5,custom:6,player:7};var Hr=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function c(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))};const Ur=()=>{try{const{timing:e}=performance;return e.responseStart-e.requestStart}catch(e){return-1}},Fr=()=>{var e,t;try{return null!==(t=null===(e=performance.getEntriesByType("paint").find((e=>"first-paint"===e.name)))||void 0===e?void 0:e.startTime)&&void 0!==t?t:-1}catch(e){return-1}},Jr=()=>{var e,t;try{return null!==(t=null===(e=performance.getEntriesByType("paint").find((e=>"first-contentful-paint"===e.name)))||void 0===e?void 0:e.startTime)&&void 0!==t?t:-1}catch(e){return-1}},Kr=()=>Hr(void 0,void 0,void 0,(function*(){let e=0,t=0,n=[];return yield new Promise(((r,o)=>{const i=setTimeout((()=>{r(-1)}),10);try{new PerformanceObserver((o=>{for(const r of o.getEntries())if(!r.hadRecentInput){const o=n[0],i=n[n.length-1];t>0&&r.startTime-i.startTime<1e3&&r.startTime-o.startTime<5e3?(t+=r.value,n.push(r)):(t=r.value,n=[r]),t>e&&(e=t)}clearTimeout(i),r(e)})).observe({type:"layout-shift",buffered:!0})}catch(e){clearTimeout(i),r(-1)}}))})),Vr=()=>Hr(void 0,void 0,void 0,(function*(){return yield new Promise(((e,t)=>{const n=setTimeout((()=>{e(-1)}),10);try{new PerformanceObserver((t=>{for(const r of t.getEntries())return clearTimeout(n),void e(r.startTime)})).observe({type:"largest-contentful-paint",buffered:!0})}catch(t){clearTimeout(n),e(-1)}}))})),qr=()=>Hr(void 0,void 0,void 0,(function*(){return yield new Promise(((e,t)=>{const n=setTimeout((()=>{e(-1)}),10);try{if(PerformanceObserver.supportedEntryTypes.includes("first-input")){const t=new PerformanceObserver((n=>{for(const r of n.getEntries())return e(r.processingStart-r.startTime),void t.disconnect()}));t.observe({type:"first-input",buffered:!0})}else{const t=performance.getEntriesByType("first-input")[0];clearTimeout(n),e(t.processingStart-t.startTime)}}catch(t){clearTimeout(n),e(-1)}}))}));function Wr(e){return Gr.apply(this,arguments)}function Gr(){return Gr=a(r().mark((function e(t){var n,o,i,a,c,s,u,l,d,p,h,v,m,g,y,b,w,E,S,O,_,R,k,T;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=0,o=0,i=0,!t){e.next=11;break}return e.next=4,Promise.all([$r(Kr),$r(Vr),$r(qr)]);case 4:a=e.sent,c=f(a,3),n=c[0],o=c[1],i=c[2],e.next=18;break;case 11:return e.next=13,Promise.all([Kr(),Vr(),qr()]);case 13:s=e.sent,u=f(s,3),n=u[0],o=u[1],i=u[2];case 18:if(l=Fr(),d=Jr(),p=Ur(),window.performance&&window.performance.timing&&window.performance.timing.loadEventEnd>0){e.next=23;break}return e.abrupt("return",Promise.reject("performance.timing.loadEventEnd is required"));case 23:return h=performance,v=h.timing,m=v.domLoading,g=v.navigationStart,y=v.domainLookupEnd,b=v.domainLookupStart,w=v.connectStart,E=v.connectEnd,S=v.requestStart,O=v.responseEnd,_=v.domComplete,R=v.domContentLoadedEventEnd,k=v.loadEventEnd,T={CLS:n,FP:l,FCP:d,LCP:o,TTFB:p,WhiteScreen:m-g,DNSLookUpTime:y-b,TCPConnectTime:E-w,HTMLDownloadTime:O-S,DOMParsedTime:_-m,DOMReadyTime:R-g,FID:i,OfflineEnv:Fn(),LoadedTime:k-g,loadedTime:k-g},Object.keys(T).forEach((function(e){var t=T[e];"number"==typeof t&&(T[e]=t<0?0:"CLS"===e?Math.round(1e3*t):Math.round(t))})),e.abrupt("return",T);case 27:case"end":return e.stop()}}),e)}))),Gr.apply(this,arguments)}function $r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;return new Promise((function(n,r){setTimeout((function(){e().then(n).catch(r)}),t)}))}var zr,Yr,Qr=function(){function e(){var t;c(this,e),l(this,"report",(function(){})),l(this,"pageReadRate",0),l(this,"isInit",!1),this.pageOpenTime=(null===(t=window.performance.timing)||void 0===t?void 0:t.navigationStart)||Date.now()}var t;return u(e,[{key:"init",value:function(e){var t=this,o=function(){var o=a(r().mark((function o(){var i,a,c,s,u,l,f,d,p,h=arguments;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=h.length>0&&void 0!==h[0]&&h[0],r.next=3,Wr(a).catch((function(){return null}));case 3:if(c=r.sent,s=t.parseData(e),a&&!c&&(c=Object.create(null)),c){r.next=8;break}return r.abrupt("return");case 8:if(!t.isInit){r.next=10;break}return r.abrupt("return");case 10:t.isInit=!0,u=(null===(i=window.performance.timing)||void 0===i?void 0:i.firstscreenfinish)||Date.now(),t.report(n({page_open_time:t.pageOpenTime,load_complete_time:u},c),"tech"),l=n(n({},s),c),t.exclusiveReport(l),t.initPageRate(),f={},d=e.sourceFrom,(p=void 0===d?"":d)&&"string"==typeof p&&(f={sourceFrom:p}),er(f);case 20:case"end":return r.stop()}}),o)})));return function(){return o.apply(this,arguments)}}();"complete"===document.readyState?o():window.addEventListener&&(window.addEventListener("DOMContentLoaded",(function(){return o()}),!1),window.addEventListener("load",(function(){return o(!0)}),!1),window.addEventListener("beforeunload",(function(){t.report({page_open_time:t.pageOpenTime,page_leave_time:Date.now(),page_read_rate:t.pageReadRate>=1?"100%":(100*t.pageReadRate).toFixed(2)+"%"},"tech")})))}},{key:"initPageRate",value:function(){var e,t,n,r,o=this,i=document.documentElement||document.body.parentNode||document.body,a=window.innerHeight,c=i.scrollHeight,s=document.getElementById("swiper-root"),u=null==s?void 0:s.swiper,l=document.getElementById("fullpage"),f=function(){return 0},d=function(){var e=f();o.pageReadRate=e&&e>o.pageReadRate?e:o.pageReadRate};if(u)f=function(){return u.slides.length?(u.activeIndex+1)/u.slides.length:0},u.on("slideChange",(function(){return d()})),u.on("init",(function(){return d()}));else if(l)f=function(){var e=l.scrollHeight,t=l.getBoundingClientRect(),n=t.top;return(t.height-n)/e},l.addEventListener("transitionend",(function(){return d()}));else if(c>a){f=function(){return(i.scrollTop+a)/c};var p=(e=function(){d(),f()>=1&&window.removeEventListener("scroll",p)},t=300,r=e,function(){var e=this;n||(n=window.setTimeout((function(){window.clearTimeout(n),n=void 0,r.apply(e)}),t))}).bind(this);window.addEventListener("scroll",p,!1)}else f=function(){return 1};d()}},{key:"parseData",value:function(e){var t=e||{},n=t.activity_group_id,r=void 0===n?"":n,o=t.activity_name,i=void 0===o?"":o,a=t.page_start_dt,c=void 0===a?"":a,s=t.page_end_dt,u=void 0===s?"":s,l=t.url;return{activity_id:r,activity_name:i,activity_start_dt:c,activity_end_dt:u,url:void 0===l?"":l,mid:Mn("DedeUserID")||""}}},{key:"exclusiveReport",value:(t=a(r().mark((function e(t){var o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ir();case 2:o=Un(),qt({eventId:"game.common.perf.0",type:"custom",msg:n(n({},t),{},{diyevent:!0,exclusiveFrom:"game",isExclusive:1}),otherSpmId:o});case 4:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}(),Xr=new Qr;function Zr(e){var t,n;return null!==(t=null===(n=RegExp("[;\\s]*".concat(e,"=([^;\\s]+)")).exec(document.cookie))||void 0===n?void 0:n[1])&&void 0!==t?t:""}function eo(){return/ipad|iphone os|android/i.test(navigator.userAgent)}function to(){}function no(){var e,t=f(null!==(e=/^(?:ff-(.+?)(?:-|\.)|(pre|uat)-)/.exec(location.hostname))&&void 0!==e?e:[],3),n=t[1],r=t[2];return null==n&&null==r||["pre","prod"].includes(n)||"pre"===r?"prod":"uat"}!function(e){e.ID011778="011778",e.ID000527="000527",e.ID000358="000358",e.ID000014="000014",e.ID000017="000017"}(Yr||(Yr={}));var ro=function(e){var t;return["".concat(location.href),"".concat(null!==(t=e.spmId)&&void 0!==t?t:"",".").concat(e.evtId).replace(/^\.*|\.*$/g,""),"",Date.now(),"","","".concat(screen.width,"x").concat(screen.height),eo()?2:1,JSON.stringify(Object.assign({},e.tags,e.data))]},oo=function(){var e,t=null!==(e=window.abtest)&&void 0!==e?e:{};return"string"==typeof window.abtest?t:JSON.stringify(t)},io=(l(zr={},Yr.ID011778,ro),l(zr,Yr.ID000527,ro),l(zr,Yr.ID000358,(function(e){var t,n,r;return["".concat(location.href),"".concat(null!==(t=document.referrer)&&void 0!==t?t:""),"".concat(null!==(n=e.spmId)&&void 0!==n?n:"",".").concat(e.evtId).replace(/^\.*|\.*$/g,""),Date.now(),null!==(r=Zr("fts"))&&void 0!==r?r:"","".concat(screen.width,"x").concat(screen.height),eo()?2:1,JSON.stringify(Object.assign({},e.tags,e.data)),"",0]})),l(zr,Yr.ID000014,(function(e){var t,n,r,o,i,a;return["".concat(location.href),"".concat(null!==(t=document.referrer)&&void 0!==t?t:""),"".concat(null!==(n=e.spmId)&&void 0!==n?n:"",".").concat(e.evtId).replace(/^\.*|\.*$/g,""),Date.now(),null!==(r=Zr("fts"))&&void 0!==r?r:"","".concat(screen.width,"x").concat(screen.height),eo()?2:1,JSON.stringify(Object.assign({},e.tags,e.data)),oo(),null!==(o=Zr("_uuid"))&&void 0!==o?o:"",null!==(i=navigator.language)&&void 0!==i?i:"",null!==(a=Zr("laboratory"))&&void 0!==a?a:"",""]})),l(zr,Yr.ID000017,(function(e){var t,n,r,o,i;return["".concat(location.href),"".concat(null!==(t=e.spmId)&&void 0!==t?t:"",".").concat(e.evtId).replace(/^\.*|\.*$/g,""),"",Date.now(),"","","".concat(screen.width,"x").concat(screen.height),eo()?2:1,JSON.stringify({event:e.evtId,value:Object.assign({},e.tags,e.data)}),oo(),"".concat(null!==(n=document.referrer)&&void 0!==n?n:""),null!==(r=Zr("_uuid"))&&void 0!==r?r:"",null!==(o=navigator.language)&&void 0!==o?o:"",null!==(i=Zr("laboratory"))&&void 0!==i?i:"",""]})),zr),ao={};function co(e){return so.apply(this,arguments)}function so(){return(so=a(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ao[t]){e.next=2;break}return e.abrupt("return");case 2:if(ao[t]=!0,e.prev=3,""===Zr("buvid3")){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,fetch("//".concat(t,"/v/"),{credentials:"include"});case 8:e.next=12;break;case 10:e.prev=10,e.t0=e.catch(3);case 12:case"end":return e.stop()}}),e,null,[[3,10]])})))).apply(this,arguments)}var uo,lo,fo,po=null!=(fo=window.__ff__)&&(fo.ui.show("debugTrack"),null!==(uo=null===(lo=fo.cfg)||void 0===lo?void 0:lo.debugTrack)&&void 0!==uo&&uo);function ho(e,t){return vo.apply(this,arguments)}function vo(){return vo=a(r().mark((function e(t,n){var o,i,a,c,s,u,l=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=l.length>2&&void 0!==l[2]&&l[2],i=l.length>3&&void 0!==l[3]?l[3]:0,0!==n.length){e.next=4;break}return e.abrupt("return");case 4:if(a="string"==typeof n?n:n.join(""),c="//".concat(t,"/gol/postweb"),!o){e.next=10;break}null===(s=(u=navigator).sendBeacon)||void 0===s||s.call(u,c,a),e.next=14;break;case 10:return e.next=12,co(t);case 12:return e.next=14,fetch(c,{method:"POST",body:a,credentials:"include"}).then((function(e){if(429===e.status){var r=[1e4,2e4,4e4][i];if(null==r)return;window.setTimeout((function(){ho(t,n,!1,i+=1).catch(to)}),r)}})).catch((function(e){console.error(e)}));case 14:case"end":return e.stop()}}),e)}))),vo.apply(this,arguments)}var mo=!1,go=0;window.addEventListener("beforeunload",(function(){mo=!0,clearTimeout(go),go=window.setTimeout((function(){mo=!1}),5e3)}));var yo,bo,wo,Eo,So,Oo=function(){function e(t){var n,r,o,i,a,s=this,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(c(this,e),l(this,"queue",[]),l(this,"clearDelayFlushTimer",(function(){})),l(this,"randSendData",[]),l(this,"delayFlush",(r=!1,function(){if(!r){r=!0;var e=window.setTimeout((function(){r=!1,s.flush()}),6e4);s.clearDelayFlushTimer=function(){r=!1,clearTimeout(e)}}})),l(this,"randDelay",(function(e,t){var n=Math.random()*t,r=window.setTimeout((function(){s.randSendData=s.randSendData.filter((function(e){return e.timer!==r})),ho(s.reportHost,e,n<10,0).catch(to)}),n),o={timer:r,data:e};s.randSendData.push(o)})),l(this,"flush",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];s.clearDelayFlushTimer(),ho(s.reportHost,s.queue,e).catch(to),s.queue=[]})),l(this,"onVisbaleChange",(function(){"hidden"===document.visibilityState&&(s.randSendData.forEach((function(e){var t=e.timer;return clearTimeout(t)})),ho(s.reportHost,s.randSendData.map((function(e){return e.data})),!0).catch(to),s.randSendData=[],s.flush(!0))})),this.logId=t,this.formatter=null!==(n=u.formatter)&&void 0!==n?n:io[t],null==this.formatter)throw new Error("Undefined Formatter for logId: ".concat(t));this.opts=u,this.reportHost=(o=u.adapterFFEnv,a="uat-".concat(i="data.bilibili.com"),!1===o||"prod"===no()?i:a),document.addEventListener("visibilitychange",this.onVisbaleChange)}return u(e,[{key:"event",value:function(e,t){var r,o,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"!=typeof e)throw Error("evtId: ".concat(JSON.stringify(e)," not a string"));var c=null!==(r=null!==(o=a.sample)&&void 0!==o?o:this.opts.sample)&&void 0!==r?r:100,s=100*Math.random()>=c,u=null!==(i=po||this.opts.debug)&&void 0!==i&&i;if(!s){var l="".concat(this.logId).concat(Date.now()).concat(this.formatter(n({evtId:e,data:t},this.opts)).join("|"));if(mo||u)ho(this.reportHost,l,!0).catch(to);else{if("number"==typeof a.randDelay)return void this.randDelay(l,a.randDelay);eo()?ho(this.reportHost,l,!0).catch(to):this.queue.push(l)}this.queue.length>=10?this.flush():this.delayFlush()}}},{key:"set",value:function(e){this.opts=Object.assign({},this.opts,e)}},{key:"destroy",value:function(){this.flush(),document.removeEventListener("visibilitychange",this.onVisbaleChange)}}]),e}(),_o=function(){try{var e=performance.timing;return e.responseStart-e.requestStart}catch(e){return-1}},Ro=function(){try{var e,t;return null!==(e=null===(t=performance.getEntriesByType("paint").find((function(e){return"first-paint"===e.name})))||void 0===t?void 0:t.startTime)&&void 0!==e?e:-1}catch(e){return-1}},ko=function(){try{var e,t;return null!==(e=null===(t=performance.getEntriesByType("paint").find((function(e){return"first-contentful-paint"===e.name})))||void 0===t?void 0:t.startTime)&&void 0!==e?e:-1}catch(e){return-1}},To=function(){var e=a(r().mark((function e(){var t,n,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=0,n=0,o=[],e.next=5,new Promise((function(e,r){var i=setTimeout((function(){e(-1)}),10);try{new PerformanceObserver((function(r){for(var a=0,c=r.getEntries();a<c.length;a++){var s=c[a];if(!s.hadRecentInput){var u=o[0],l=o[o.length-1];n>0&&s.startTime-l.startTime<1e3&&s.startTime-u.startTime<5e3?(n+=s.value,o.push(s)):(n=s.value,o=[s]),n>t&&(t=n)}}clearTimeout(i),e(t)})).observe({type:"layout-shift",buffered:!0})}catch(t){clearTimeout(i),e(-1)}}));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),xo=function(){var e=a(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,t){var n=setTimeout((function(){e(-1)}),10);try{new PerformanceObserver((function(t){var r,o=v(t.getEntries());try{for(o.s();!(r=o.n()).done;){var i=r.value;return clearTimeout(n),void e(i.startTime)}}catch(e){o.e(e)}finally{o.f()}})).observe({type:"largest-contentful-paint",buffered:!0})}catch(t){clearTimeout(n),e(-1)}}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Io=function(){var e=a(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,t){var n=setTimeout((function(){e(-1)}),10);try{if(PerformanceObserver.supportedEntryTypes.includes("first-input")){var r=new PerformanceObserver((function(t){for(var n=0,o=t.getEntries();n<o.length;n++){var i=o[n];return e(i.processingStart-i.startTime),void r.disconnect()}}));r.observe({type:"first-input",buffered:!0})}else{var o=performance.getEntriesByType("first-input")[0];clearTimeout(n),e(o.processingStart-o.startTime)}}catch(t){clearTimeout(n),e(-1)}}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Po=function(){var e=a(r().mark((function e(){var t,n,o,i,a,c,s,u,l,f,d,p,h;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=performance,n=t.timing,o=n.domLoading,i=n.navigationStart,a=n.domainLookupEnd,c=n.domainLookupStart,s=n.connectStart,u=n.connectEnd,l=n.requestStart,f=n.responseEnd,d=n.domComplete,p=n.domContentLoadedEventEnd,h=n.loadEventEnd,e.next=3,To();case 3:return e.t0=e.sent,e.t1=Ro(),e.t2=ko(),e.next=8,xo();case 8:return e.t3=e.sent,e.t4=_o(),e.t5=o-i,e.t6=a-c,e.t7=u-s,e.t8=f-l,e.t9=d-o,e.t10=p-i,e.t11=h-i,e.abrupt("return",{CLS:e.t0,FP:e.t1,FCP:e.t2,LCP:e.t3,TTFB:e.t4,WhiteScreen:e.t5,DNSLookUpTime:e.t6,TCPConnectTime:e.t7,HTMLDownloadTime:e.t8,DOMParsedTime:e.t9,DOMReadyTime:e.t10,loadedTime:e.t11});case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),No=function(e){var t=["mousedown","keydown","touchstart"],n={FID:-1},r=function r(){t.forEach((function(e){window.removeEventListener(e,r)})),Io().then((function(t){n.FID=t,e(n)})).catch((function(e){console.warn(e)}))};t.forEach((function(e){window.addEventListener(e,r)}))},jo=function(e){function t(){window.removeEventListener("load",t),setTimeout((function(){Po().then((function(t){e(t)})).catch((function(e){console.warn(e)}))}),10)}performance&&performance.timing&&performance.timing.loadEventEnd&&0!==performance.timing.loadEventEnd?t():window.addEventListener("load",t)};!function(e){e.Custom="Custom",e.Perf="Perf",e.Experience="Experience"}(yo||(yo={})),function(e){e.Custom="custom",e.Perf="perf",e.Error="error",e.Player="player"}(So||(So={}));var Co=window,Lo=function(e){var t=e.method.toLocaleUpperCase(),n="POST"===t?JSON.stringify(e.data):"",r="GET"===t?function(e){if(!Object.keys(e).length)return"";var t="";for(var n in e)t+="".concat(n,"=").concat(e[n],"&");return t.substring(0,t.length-1)}(e.data):"",i=r?-1!==e.url.indexOf("?")?"".concat(e.url,"&").concat(r):"".concat(e.url,"?").concat(r):e.url;return new Promise((function(r,a){var c=new XMLHttpRequest;if(c.onreadystatechange=function(){if(c.readyState===XMLHttpRequest.DONE)if(200===c.status){var e=null;try{e=JSON.parse(c.responseText)}catch(t){e=c.responseText}r(e)}else a(c.responseText)},c.withCredentials=!0,c.open(t,i,!0),"POST"===t&&e.headers&&"object"===o(e.headers))for(var s in e.headers)c.setRequestHeader(s,e.headers[s]);c.send(n)}))},Ao=function(){var e=a(r().mark((function e(t){var o,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={eventId:t.eventId,ctime:Date.now(),extendedFields:{referer:document.referrer,ua:navigator.userAgent}},i=[n(n({},o),{},{mid:Zr("DedeUserID"),buvid:Zr("buvid3")?Zr("buvid3"):Zr("buvid4"),extendedFields:n(n({},o.extendedFields),{},{apmType:t.type},t.msg)})],e.abrupt("return",new Promise((function(e,t){Lo({url:"https://api.bilibili.com/x/web-frontend/data/collector",method:"POST",data:i,headers:{"Content-Type":"text/plain;charset=UTF-8"}}).then((function(t){return e(t)})).catch((function(e){return t(e)}))})));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var Do=eo()?"h5":"pc",Bo=null!==(bo=Zr("fts"))&&void 0!==bo?bo:"",Mo="".concat(screen.width,"x").concat(screen.height),Ho="UTC+"+(0-(new Date).getTimezoneOffset()/60).toString(),Uo=null!==(wo=Zr("fingerprint"))&&void 0!==wo?wo:"",Fo=null!==(Eo=Zr("SESSDATA"))&&void 0!==Eo?Eo:"",Jo="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),Ko=function(e){var t,n,r,o,i,a=+(null!==(t=sessionStorage.getItem("sn"))&&void 0!==t?t:0)+1,c=sessionStorage.getItem("sn_gen_time");null==c&&(c=String(Date.now()),sessionStorage.setItem("sn_gen_time",c)),sessionStorage.setItem("sn",String(a));var s=e.data,u=s.event_category,l=s.event_code,f=s.event_value,d=s.extra;return[JSON.stringify({app_id:100,platform:Do,fts:Bo,screen_resolution:Mo,timezone:Ho,bilifp:Uo}),JSON.stringify({network_info:null!==(n=null===(r=navigator.connection)||void 0===r?void 0:r.effectiveType)&&void 0!==n?n:"",url:location.href,refer_url:document.referrer,logver:"",abtest:window.abtest,ptype:null!==(o=null===(i=e.data)||void 0===i?void 0:i.pageType)&&void 0!==o?o:"",window_size:"".concat(document.documentElement.clientWidth,"x").concat(document.documentElement.clientHeight),pvid:Jo,session_id:Fo}),e.evtId,e.evtId.split(".").shift(),a,c,Date.now(),Date.now(),u,l,null==f?"":JSON.stringify(f),JSON.stringify(Object.assign({},e.tags,d))]},Vo=function(){function e(t,i){var s=this;c(this,e),l(this,"tracker",null),l(this,"logId","020362"),l(this,"spmId",""),l(this,"errorSample",{globalError:0,unhandledRejection:0,assetLoadError:0,customError:0}),l(this,"hatate",null),l(this,"fmp",(function(){var e=performance.now();s.sendPerf({extra:{fmp:e}},"fmp")})),l(this,"perf",(function(e){s.sendPerf({extra:e},"customPerf")})),l(this,"error",(function(e,t){null!==s.hatate?s.hatate.withScope((function(n){var r;n.update(null==t?void 0:t.context),null===(r=s.hatate)||void 0===r||r.captureCustomException(e)})):console.error("错误采集SDK未初始化")})),l(this,"custom",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";s.send(e,{category:So.Custom,code:n,value:t})})),l(this,"initMetrics",(function(){No((function(e){s.sendPerf({data:e})})),jo((function(e){s.sendPerf({data:e})}))})),l(this,"reportMirror",(function(e,t,n){Ao({eventId:"live.tech."+e,type:"error."+t,msg:function(e){var t={};for(var n in e)t[n]="object"===o(e[n])?JSON.stringify(e):e[n];return t}(n)}).catch(console.error)})),l(this,"initError",a(r().mark((function e(){var t,n,o,i,a,c,u,l,f,d,p,h,v,m,g,y,b,w,E,S,O,_,R;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(null===(t=s.opts)||void 0===t?void 0:t.errorConfig)){e.next=2;break}return e.abrupt("return");case 2:if(i=null!==(n=null===(o=s.opts)||void 0===o?void 0:o.errorConfig)&&void 0!==n?n:{projVer:"",environment:""},a=i.projVer,c=i.environment,"string"==typeof a&&"string"==typeof c){e.next=5;break}return e.abrupt("return");case 5:if(u="//s1.hdslb.com/bfs/blive-engineer/bbfe/hatate/hatate-browser.js",l="//uat-s1.hdslb.com/bfs/blive-engineer/bbfe/hatate/hatate-browser.js",e.prev=7,null==(null===(f=Co.HatateBrowser)||void 0===f?void 0:f.create)){e.next=12;break}!0===(null===(y=s.opts)||void 0===y?void 0:y.debug)&&console.log("Hatate已载入，跳过加载过程"),e.next=15;break;case 12:return b="prod"===no()?u:l,e.next=15,s.loadScript(b);case 15:s.errorSample={globalError:s.getErrorSample("globalError"),unhandledRejection:s.getErrorSample("unhandledRejection"),assetLoadError:s.getErrorSample("assetLoadError"),customError:s.getErrorSample("customError")},w=s.errorSample,E=w.globalError,S=w.unhandledRejection,O=w.assetLoadError,_=s.customInstruments(),R={debug:null!==(d=null===(p=s.opts)||void 0===p?void 0:p.debug)&&void 0!==d&&d,release:a,environment:c,globalHandlers:{globalError:E>0,unhandledRejection:S>0,assetLoadError:O>0},instruments:_,reportHandler:function(e){var t;["globalError","unhandledRejection","assetLoadError","customError"].includes((t=e).type)&&"name"in t&&s.sendError(e.type,e)}},null!=(null===(h=s.opts)||void 0===h||null===(v=h.errorConfig)||void 0===v?void 0:v.vueIns)&&(R.vueErrorHandler={vue:s.opts.errorConfig.vueIns}),s.hatate=null!==(m=null===(g=Co.HatateBrowser)||void 0===g?void 0:g.create(R))&&void 0!==m?m:null,e.next=26;break;case 23:e.prev=23,e.t0=e.catch(7),console.warn("错误采集SDK加载失败",e.t0);case 26:case"end":return e.stop()}}),e,null,[[7,23]])})))),l(this,"loadScript",function(){var e=a(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){var r=document.createElement("script");r.type="text/javascript",r.onload=function(){return e("")},r.onerror=function(e){return n(e)},r.src=t,document.getElementsByTagName("head")[0].appendChild(r)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),l(this,"getErrorSample",(function(e){var t,n,r,o,i=null!==(t=null===(n=s.opts)||void 0===n||null===(r=n.errorConfig)||void 0===r?void 0:r.autoError)&&void 0!==t?t:0;return"number"==typeof i?100*i:"[object Object]"===Object.prototype.toString.call(i)?100*(null!==(o=i[e])&&void 0!==o?o:0):0})),l(this,"customInstruments",(function(){var e,t,n,r=null===(e=s.opts)||void 0===e||null===(t=e.errorConfig)||void 0===t?void 0:t.ignoreTrack,o={},i={denyUrls:d(new Set(["data.bilibili.com"].concat(null!==(n=null==r?void 0:r.url)&&void 0!==n?n:[])))};return o.fetch=i,o.xhr=i,Array.isArray(null==r?void 0:r.type)&&(null==r||r.type.forEach((function(e){o[e]=!1}))),o})),l(this,"sendPerf",(function(e,t){var n=e.data,r=e.extra;s.send("perf",{category:So.Perf,code:null!=t?t:"",value:n,extra:r})})),l(this,"sendError",(function(e,t){var r;s.send("error",{category:So.Error,code:e,value:t},null!==(r=s.errorSample[e])&&void 0!==r?r:0),s.reportMirror(So.Error,e,n(n({},t),{},{url:window.location.href+window.location.pathname,business:document.title,spmid:s.spmId,error_type:t.typem,error_msg:t.message}))})),l(this,"send",(function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;null===(n=s.tracker)||void 0===n||n.event([s.spmId,e].join("."),{event_category:t.category,event_code:t.code,event_value:t.value,extra:t.extra},{sample:r})})),this.spmId=t,this.opts=i,this.initTracker(),this.initMetrics(),this.initError().catch((function(e){console.warn(e)}))}return u(e,[{key:"initTracker",value:function(){var e,t;this.tracker=new Oo(this.logId,{spmId:this.spmId,debug:null===(e=this.opts)||void 0===e?void 0:e.debug,tags:null===(t=this.opts)||void 0===t?void 0:t.tags,formatter:Ko})}}]),e}();function qo(){return location&&location.hostname?"".concat(location.hostname,"(").concat(2==(e=window.navigator.userAgent.toLowerCase(),/iphone|ipad|ipod/.test(e)?2:1)?"iOS":"Android",")"):"";var e}function Wo(e,t,n,r){return e?r?"".concat(e,".").concat(t||0,".").concat(n||0,".").concat(r):"".concat(e,".").concat(t||0,".").concat(n||0):""}var Go,$o,zo=function(){function e(){c(this,e),l(this,"gamelog",!0),l(this,"logEventTracker",(function(){})),l(this,"logAppearTracker",(function(){})),l(this,"logTechTracker",(function(){}));var t=window;t.reportConfig=(null==t?void 0:t.reportConfig)||{};var r=t.reportConfig,o=r.sevAppId,i=r.nativeReport,a=void 0!==i&&i,s=r.commonData,u=void 0===s?{}:s,f=r.msgObjects,d=void 0===f?"":f,p=r.pvMsg,h=void 0===p?{}:p,v=Un();o||(this.gamelog=!1),this.traceId=null==Dr?void 0:Dr(),this.sevAppId=o,this.commonData=n(n({},u),{},{from_spmid:Jn("from_spmid")||"",source:Jn("source")||""});var m=Jn("sourceFrom")||Jn("sourcefrom")||"";m&&(this.commonData=n(n({},this.commonData),{},{sourceFrom:m}));var g=function(){var e,t,n,r,o=document.querySelector("html");if(!o)return"";var i=o.getAttribute("game_base_ids")||"";if(i)return i;var a=o.getAttribute("game_base_id")||"",c=null===(e=window)||void 0===e||null===(t=e.$config)||void 0===t?void 0:t.game_base_id,s=null===(n=window)||void 0===n||null===(r=n.$mngConfig)||void 0===r?void 0:r.game_base_id,u=o.getAttribute("game-id")||"";return a||c||s||u||""}();g&&(this.commonData=n(n({},this.commonData),{},{game_base_id:g})),this.nativeReport=a,this.msgObjects=d,this.spmPrefix=v,this.spmId=v?"".concat(v,".0.0"):"",t.reportConfig.pvMsg=n(n({},h),this.commonData)}var t,i;return u(e,[{key:"init",value:(i=a(r().mark((function e(){var t,o,i,a,c,s,u;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Wn("sdkVersion"),o=Object.keys(Dn),(i=Jn("from_spmid")||"")&&(a=window,this.commonData=n(n({},this.commonData),{},{from_spmid:i}),a.reportConfig.pvMsg=n(n({},a.reportConfig.pvMsg),{},{from_spmid:i})),c=new Vo(this.spmId,{tags:this.commonData}),this.logTechTracker=c.custom;try{Xr.report=this.customReport.bind(this),Xr.init(this.commonData)}catch(e){console.log("AutoPageLog init error")}if(Ir(this.commonData),"pb"!==t){e.next=13;break}return e.next=11,rr();case 11:return s=e.sent,e.abrupt("return",s);case 13:if(null==t||!t.includes(".")){e.next=19;break}return e.next=16,Gn(t);case 16:case 22:return e.abrupt("return");case 19:if(!t||-1===o.indexOf(t)){e.next=23;break}return e.next=22,Vn(Dn[t]);case 23:if(u=n({event_name:"pv",type:"pv"},this.commonData),this.sendGameLog(u),!this.nativeReport){e.next=30;break}return e.next=28,Yn();case 28:return this.sendNativeLog(this.spmId,u,"pv"),e.abrupt("return");case 30:return e.next=32,ur("pv",this.spmId);case 32:return e.abrupt("return",e.sent);case 33:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"customReport",value:function(){for(var e="selfDef",t="000000",r="",i=arguments.length,a=new Array(i),c=0;c<i;c++)a[c]=arguments[c];var s=a[0],u=a[1]||"click";if(a[0]&&"string"==typeof a[0]){var l=(-1!==a[0].indexOf(".")?a[0]:"selfDef.".concat(a[0])).split(".");e=l[0],t=l[1],r=l.slice(2).join("."),s=a[1]||{},u=a[2]||"click"}if((s=n(n({log_id_web:null==Dr?void 0:Dr(),event_name:u,type:u,spm_id:Wo(this.spmPrefix,e,t,r)},this.commonData),"object"!==o(s)?{}:s)).extra&&(s.extra=JSON.stringify(s.extra)),"download"===u){var f=window.event;if(f){var d=f.target||f.srcElement;if(d&&"A"===d.tagName&&d.href&&0===d.href.indexOf("bilibili://game_center/detail"))return}}ur(u,s.spm_id,s),this.sendGameLog(s),this.sendNativeLog(s.spm_id,s,u)}},{key:"initLogReport",value:(t=a(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.reportObserver){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,Vn(Dn["log-2017"],{async:!0});case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log("log-report 初始化失败！",e.t0);case 10:case"end":return e.stop()}}),e,null,[[2,7]])}))),function(){return t.apply(this,arguments)})},{key:"sendGameLog",value:function(e){if(this.gamelog){var t=e.log_id_web||(null==Dr?void 0:Dr()),r=window.innerWidth||document.body&&document.body.clientWidth,o=window.innerHeight||document.body&&document.body.clientHeight,i=Date.now(),a=qn(window.abtest),c=n({log_id_web:t,_uuid:Mn("_uuid"),pageType:Bn(),app_id:this.sevAppId,curHost:qo(),spmid:this.spmId,mid:Mn("DedeUserID"),mid_web:Mn("DedeUserID"),buvid3:Mn("buvid3"),buvid:Mn("buvid3"),refer_url:document.referrer?encodeURIComponent(document.referrer).substr(0,1e3):"",url:encodeURIComponent(location.href).substr(0,1e3),url_detail:location.search,url_main:location.protocol+"//"+location.host+location.pathname,browser_resolution:r+"x"+o,language:navigator.language,timestamp:i,fts:Mn("fts")||"",laboratory:Mn("laboratory")||"",ptype:Bn(),abtest:a},e);Br([{log_id:t,trace_id:c._uuid||this.traceId,level:2,ts:i,kvs:c}],this.sevAppId)}}},{key:"sendNativeLog",value:function(e,t,n){this.nativeReport&&function(e,t,n){Nn("ability.reportEventV3").then((function(r){r?An.callNative({method:"ability.reportEventV3",data:{event:e,params:qn(t),type:Mr[n]||0,label:"webviewTracker"},callback:function(){console.log("WebviewTracker success")}}):console.log("Do not support report method.")}))}(e,t,n)}}]),e}(),Yo=null,Qo=new Promise((function(e,t){Go=e,$o=t}));function Xo(){return Zo.apply(this,arguments)}function Zo(){return(Zo=a(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Yo){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,Yo=new zo,e.next=6,Yo.init();case 6:t=e.sent,Go(t),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(2),console.log(e.t0),Yo=null,$o(e.t0);case 15:case"end":return e.stop()}}),e,null,[[2,10]])})))).apply(this,arguments)}"undefined"!=typeof window&&null===Yo&&Xo();var ei=Rr;e.customReport=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;Yo?Yo.customReport(e,t,n):console.warn("Game Report is not ready")},e.errorReport=ei,e.ready=Qo,e.register=Xo}));
// @preserve: game-report v0.9.3
